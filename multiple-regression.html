<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6 Multiple Regression | Statistical Inference via Data Science</title>
<meta name="author" content="Chester Ismay, Albert Y. Kim, and Arturo Valdivia   Foreword by Kelly S. McConville">
<meta name="description" content="In Chapter 5, we studied simple linear regression as a model that represents the relationship between two variables: an outcome variable or response \(y\) and an explanatory variable or regressor...">
<meta name="generator" content="bookdown 0.43 with bs4_book()">
<meta property="og:title" content="Chapter 6 Multiple Regression | Statistical Inference via Data Science">
<meta property="og:type" content="book">
<meta property="og:description" content="In Chapter 5, we studied simple linear regression as a model that represents the relationship between two variables: an outcome variable or response \(y\) and an explanatory variable or regressor...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 6 Multiple Regression | Statistical Inference via Data Science">
<meta name="twitter:site" content="@ModernDive">
<meta name="twitter:description" content="In Chapter 5, we studied simple linear regression as a model that represents the relationship between two variables: an outcome variable or response \(y\) and an explanatory variable or regressor...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.9.0/transition.js"></script><script src="libs/bs3compat-0.9.0/tabs.js"></script><script src="libs/bs3compat-0.9.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="libs/dygraphs-1.1.1/dygraph.css" rel="stylesheet">
<script src="libs/dygraphs-1.1.1/dygraph-combined.js"></script><script src="libs/dygraphs-1.1.1/shapes.js"></script><script src="libs/moment-2.8.4/moment.js"></script><script src="libs/moment-timezone-0.2.5/moment-timezone-with-data.js"></script><script src="libs/moment-fquarter-1.0.0/moment-fquarter.min.js"></script><script src="libs/dygraphs-binding-1.1.1.6/dygraphs.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-YVFBK9P73R"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-YVFBK9P73R');
    </script><!-- Open Graph Meta Tags --><meta property="og:title" content="ModernDive V2">
<meta property="og:description" content="An open-source and fully-reproducible electronic textbook for teaching statistical inference using tidyverse data science tools.">
<meta property="og:image" content="https://moderndive.com/v2/images/logos/v2_cover.jpg">
<meta property="og:url" content="https://moderndive.com/v2/multiple-regression.html">
<meta name="twitter:card" content="summary_large_image">
<!-- Set up favicon --><link rel="icon" href="images/logos/favicons/favicon.ico" type="image/x-icon">
<!-- Redirect to ModernDive V2 --><script>
      if (window.location.pathname === '/v2') {
        window.location.replace(window.location.pathname + '/');
      }
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="A ModernDive into R and the Tidyverse &lt;br&gt; (Second Edition)">Statistical Inference via Data Science</a>:
        <small class="text-muted">A ModernDive into R and the Tidyverse <br> (Second Edition)</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome to ModernDive (v2)</a></li>
<li><a class="" href="foreword.html">Foreword</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="about-the-authors.html">About the authors</a></li>
<li><a class="" href="getting-started.html"><span class="header-section-number">1</span> Getting Started with Data in R</a></li>
<li class="book-part">Data Science with tidyverse</li>
<li><a class="" href="viz.html"><span class="header-section-number">2</span> Data Visualization</a></li>
<li><a class="" href="wrangling.html"><span class="header-section-number">3</span> Data Wrangling</a></li>
<li><a class="" href="tidy.html"><span class="header-section-number">4</span> Data Importing and Tidy Data</a></li>
<li class="book-part">Statistical Modeling with moderndive</li>
<li><a class="" href="regression.html"><span class="header-section-number">5</span> Simple Linear Regression</a></li>
<li><a class="active" href="multiple-regression.html"><span class="header-section-number">6</span> Multiple Regression</a></li>
<li class="book-part">Statistical Inference with infer</li>
<li><a class="" href="sampling.html"><span class="header-section-number">7</span> Sampling</a></li>
<li><a class="" href="confidence-intervals.html"><span class="header-section-number">8</span> Estimation, Confidence Intervals, and Bootstrapping</a></li>
<li><a class="" href="hypothesis-testing.html"><span class="header-section-number">9</span> Hypothesis Testing</a></li>
<li><a class="" href="inference-for-regression.html"><span class="header-section-number">10</span> Inference for Regression</a></li>
<li class="book-part">Conclusion</li>
<li><a class="" href="thinking-with-data.html"><span class="header-section-number">11</span> Tell Your Story with Data</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="appendixA.html"><span class="header-section-number">A</span> Statistical Background</a></li>
<li><a class="" href="appendixB.html"><span class="header-section-number">B</span> Inference Examples</a></li>
<li><a class="" href="appendixC.html"><span class="header-section-number">C</span> Tips and Tricks</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/moderndive/ModernDive_book/">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><img src="https://moderndive.com/wide_format.png" alt="ModernDive" style="max-width: 100%; width: 100%; height: auto; display: block; margin: 0 auto; padding-top: 10px;"><div id="multiple-regression" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> Multiple Regression<a class="anchor" aria-label="anchor" href="#multiple-regression"><i class="fas fa-link"></i></a>
</h1>
<p>In Chapter <a href="regression.html#regression">5</a>, we studied simple linear regression as a
model that represents the relationship between two variables: an outcome
variable or response <span class="math inline">\(y\)</span> and an explanatory variable or regressor <span class="math inline">\(x\)</span>.
Furthermore, to keep things simple, we only considered models with one
explanatory <span class="math inline">\(x\)</span> variable that was either numerical in Section
<a href="regression.html#model1">5.1</a> or categorical in Section <a href="regression.html#model2">5.2</a>.</p>
<p>In this chapter, we introduce multiple linear regression, the direct
extension to simple linear regression when more than one explanatory
variable is taken into account to explain changes in the outcome
variable. As we show in the next few sections, much of the material
developed for simple linear regression translates directly into multiple
linear regression, but the interpretation of the associated effect of
any one explanatory variable must be made taking into account the other
explanatory variables included in the model.</p>
<div id="mult-reg-packages" class="section level2 unnumbered">
<h2>Needed packages<a class="anchor" aria-label="anchor" href="#mult-reg-packages"><i class="fas fa-link"></i></a>
</h2>
<p>If needed, read Section <a href="getting-started.html#packages">1.3</a> for information on how to
install and load R packages.</p>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://moderndive.github.io/moderndive/">moderndive</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.statlearning.com">ISLR2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div id="model4" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> One numerical and one categorical explanatory variable<a class="anchor" aria-label="anchor" href="#model4"><i class="fas fa-link"></i></a>
</h2>
<p>We continue using the UN member states dataset introduced in Section
<a href="regression.html#model1">5.1</a>. Recall that we studied the relationship between the
outcome variable fertility rate, <span class="math inline">\(y\)</span>, and the regressor life expectancy,
<span class="math inline">\(x\)</span>.</p>
<p>In this section, we introduce one additional regressor to this model:
the categorical variable <code>income group</code> with four categories:
<code>Low income</code>, <code>Lower middle income</code>, <code>Upper middle income</code>, and
<code>High income</code>. We now want to study how fertility rate changes due to
changes in life expectancy and different income levels. To do this, we
use <em>multiple regression</em>. Observe
that we now have:</p>
<ol style="list-style-type: decimal">
<li>A numerical outcome variable <span class="math inline">\(y\)</span>, the fertility rate in a given
country or state, and</li>
<li>Two explanatory variables:
<ol style="list-style-type: lower-alpha">
<li>A numerical explanatory variable <span class="math inline">\(x_1\)</span>, the life expectancy.</li>
<li>A categorical explanatory variable <span class="math inline">\(x_2\)</span>, the income group.</li>
</ol>
</li>
</ol>
<div id="model4EDA" class="section level3" number="6.1.1">
<h3>
<span class="header-section-number">6.1.1</span> Exploratory data analysis<a class="anchor" aria-label="anchor" href="#model4EDA"><i class="fas fa-link"></i></a>
</h3>
<p>The UN member states data frame is included in the <code>moderndive</code> package.
To keep things simple, we <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> only the subset of the variables
needed here, and save this data in a new data frame called
<code>UN_data_ch6</code>. Note that the variables used are different than the ones
chosen in Chapter <a href="regression.html#regression">5</a>. We also set the <code>income</code> variable
to be a <code>factor</code> so that its levels show up in the expected order.</p>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">UN_data_ch6</span> <span class="op">&lt;-</span> <span class="va">un_member_states_2024</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">country</span>, </span>
<span>         <span class="va">life_expectancy_2022</span>, </span>
<span>         <span class="va">fertility_rate_2022</span>, </span>
<span>         <span class="va">income_group_2024</span><span class="op">)</span><span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="op">)</span><span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>life_exp <span class="op">=</span> <span class="va">life_expectancy_2022</span>, </span>
<span>         fert_rate <span class="op">=</span> <span class="va">fertility_rate_2022</span>, </span>
<span>         income <span class="op">=</span> <span class="va">income_group_2024</span><span class="op">)</span><span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">income</span>, </span>
<span>                         levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Low income"</span>, <span class="st">"Lower middle income"</span>, </span>
<span>                                    <span class="st">"Upper middle income"</span>, <span class="st">"High income"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Recall the three common steps in an exploratory data analysis we saw in
Subsection <a href="regression.html#model1EDA">5.1.1</a>:</p>
<ol style="list-style-type: decimal">
<li>Inspecting a sample of raw values.</li>
<li>Computing summary statistics.</li>
<li>Creating data visualizations.</li>
</ol>
<p>We first look at the raw data values by either looking at <code>UN_data_ch6</code>
using RStudio’s spreadsheet viewer or by using the <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> function
from the <code>dplyr</code> package:</p>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">UN_data_ch6</span><span class="op">)</span></span></code></pre></div>
<pre><code>Rows: 182
Columns: 4
$ country   &lt;chr&gt; "Afghanistan", "Albania", "Algeria", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", "Austr…
$ life_exp  &lt;dbl&gt; 53.6, 79.5, 78.0, 62.1, 77.8, 78.3, 76.1, 83.1, 82.3, 74.2, 76.1, 79.9, 74.7, 78.5, 74.3, 81.9, 75.8…
$ fert_rate &lt;dbl&gt; 4.3, 1.4, 2.7, 5.0, 1.6, 1.9, 1.6, 1.6, 1.5, 1.6, 1.4, 1.8, 1.9, 1.6, 1.5, 1.6, 2.0, 4.7, 1.4, 2.5, …
$ income    &lt;fct&gt; Low income, Upper middle income, Lower middle income, Lower middle income, High income, Upper middle…</code></pre>
<p>The variable <code>country</code> contains all the UN member states. R reads this
variable as character, <code>&lt;chr&gt;</code>, and beyond the country identification it
will not be needed for the analysis. The variables life expectancy,
<code>life_exp</code>, and fertility rate, <code>fert_rate</code>, are numerical, and the
variable income, <code>income</code>, is categorical. In R, categorical variables
are called factors and the categories are factor levels.</p>
<p>We also display a random sample of 10 rows of the 182 rows
corresponding to different countries in Table
<a href="multiple-regression.html#tab:model4-data-preview">6.1</a>. Remember due to the random nature of the
sampling, you will likely end up with a different subset of 10 rows.</p>
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">UN_data_ch6</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table" style="font-size: 16px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:model4-data-preview">TABLE 6.1: </span>A random sample of 10 out of 182 UN member states
</caption>
<thead><tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
life_exp
</th>
<th style="text-align:right;">
fert_rate
</th>
<th style="text-align:left;">
income
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Trinidad and Tobago
</td>
<td style="text-align:right;">
75.9
</td>
<td style="text-align:right;">
1.6
</td>
<td style="text-align:left;">
High income
</td>
</tr>
<tr>
<td style="text-align:left;">
Micronesia, Federated States of
</td>
<td style="text-align:right;">
74.4
</td>
<td style="text-align:right;">
2.6
</td>
<td style="text-align:left;">
Lower middle income
</td>
</tr>
<tr>
<td style="text-align:left;">
North Macedonia
</td>
<td style="text-align:right;">
76.8
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:left;">
Upper middle income
</td>
</tr>
<tr>
<td style="text-align:left;">
Portugal
</td>
<td style="text-align:right;">
81.5
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:left;">
High income
</td>
</tr>
<tr>
<td style="text-align:left;">
Madagascar
</td>
<td style="text-align:right;">
68.2
</td>
<td style="text-align:right;">
3.7
</td>
<td style="text-align:left;">
Low income
</td>
</tr>
<tr>
<td style="text-align:left;">
Cambodia
</td>
<td style="text-align:right;">
70.7
</td>
<td style="text-align:right;">
2.3
</td>
<td style="text-align:left;">
Lower middle income
</td>
</tr>
<tr>
<td style="text-align:left;">
Dominica
</td>
<td style="text-align:right;">
78.2
</td>
<td style="text-align:right;">
1.6
</td>
<td style="text-align:left;">
Upper middle income
</td>
</tr>
<tr>
<td style="text-align:left;">
Peru
</td>
<td style="text-align:right;">
68.9
</td>
<td style="text-align:right;">
2.1
</td>
<td style="text-align:left;">
Upper middle income
</td>
</tr>
<tr>
<td style="text-align:left;">
Cyprus
</td>
<td style="text-align:right;">
79.7
</td>
<td style="text-align:right;">
1.3
</td>
<td style="text-align:left;">
High income
</td>
</tr>
<tr>
<td style="text-align:left;">
Guinea-Bissau
</td>
<td style="text-align:right;">
63.7
</td>
<td style="text-align:right;">
3.8
</td>
<td style="text-align:left;">
Low income
</td>
</tr>
</tbody>
</table></div>
<p>Life expectancy, <code>life_exp</code>, is an estimate of how many years, on
average, a person in a given country is expected to live. Fertility
rate, <code>fert_rate</code>, is the average number of live births per woman of
childbearing age in a country. As we did in our exploratory data
analyses in Sections <a href="regression.html#model1EDA">5.1.1</a> and <a href="regression.html#model2EDA">5.2.1</a> from Chapter
<a href="regression.html#regression">5</a>, we find summary statistics:</p>
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">UN_data_ch6</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">life_exp</span>, <span class="va">fert_rate</span>, <span class="va">income</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="moderndive.github.io/moderndive/reference/tidy_summary.html">tidy_summary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table" style="font-size: 16px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
column
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:left;">
group
</th>
<th style="text-align:left;">
type
</th>
<th style="text-align:right;">
min
</th>
<th style="text-align:right;">
Q1
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
median
</th>
<th style="text-align:right;">
Q3
</th>
<th style="text-align:right;">
max
</th>
<th style="text-align:right;">
sd
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
life_exp
</td>
<td style="text-align:right;">
182
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:right;">
53.6
</td>
<td style="text-align:right;">
69.4
</td>
<td style="text-align:right;">
73.67
</td>
<td style="text-align:right;">
75.2
</td>
<td style="text-align:right;">
78.4
</td>
<td style="text-align:right;">
86.4
</td>
<td style="text-align:right;">
6.86
</td>
</tr>
<tr>
<td style="text-align:left;">
fert_rate
</td>
<td style="text-align:right;">
182
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:right;">
0.9
</td>
<td style="text-align:right;">
1.6
</td>
<td style="text-align:right;">
2.49
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:right;">
3.2
</td>
<td style="text-align:right;">
6.6
</td>
<td style="text-align:right;">
1.16
</td>
</tr>
<tr>
<td style="text-align:left;">
income
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:left;">
Low income
</td>
<td style="text-align:left;">
factor
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
income
</td>
<td style="text-align:right;">
52
</td>
<td style="text-align:left;">
Lower middle income
</td>
<td style="text-align:left;">
factor
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
income
</td>
<td style="text-align:right;">
49
</td>
<td style="text-align:left;">
Upper middle income
</td>
<td style="text-align:left;">
factor
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
<tr>
<td style="text-align:left;">
income
</td>
<td style="text-align:right;">
56
</td>
<td style="text-align:left;">
High income
</td>
<td style="text-align:left;">
factor
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
<td style="text-align:right;">
</td>
</tr>
</tbody>
</table></div>
<p>Recall that each row in <code>UN_data_ch6</code> represents a particular country or
UN member state. The <code><a href="moderndive.github.io/moderndive/reference/tidy_summary.html">tidy_summary()</a></code> function shows a summary for the
numerical variables life expectancy (<code>life_exp</code>), fertility rate
(<code>fert_rate</code>), and the categorical variable income group (<code>income</code>).
When the variable is numerical, the <code><a href="moderndive.github.io/moderndive/reference/tidy_summary.html">tidy_summary()</a></code> function provides
the total number of observations in the data frame, the five-number
summary, the mean, and the standard deviation.</p>
<p>For example, the first
row of our summary refers to life expectancy as <code>life_exp</code>. There are
182 observations for this variable, it is a numerical
variable, and the first quartile, <code>Q1</code>, is 69.4; this means that the
life expectancy of 25% of the UN member states is less than 69.4 years.
When a variable in the dataset is categorical, also called a <code>factor</code>,
the summary shows all the categories or factor levels and the number of
observations for each level. For example, income group (<code>income</code>) is a
factor with four levels: <code>Low Income</code>, <code>Lower middle income</code>,
<code>Upper middle income</code>, and <code>High income</code>. The summary also provides the
number of states for each factor level; observe, for example, that the
dataset has 56 UN member states that are considered <code>High Income</code>
states.</p>
<p>Furthermore, we can compute the correlation coefficient between our two
numerical variables: <code>life_exp</code> and <code>fert_rate</code>. Recall from Subsection
<a href="regression.html#model1EDA">5.1.1</a> that correlation coefficients only exist between
numerical variables. We observe that they are “strongly negatively”
correlated.</p>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">UN_data_ch6</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="moderndive.github.io/moderndive/reference/get_correlation.html">get_correlation</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">fert_rate</span> <span class="op">~</span> <span class="va">life_exp</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 1 × 1
     cor
   &lt;dbl&gt;
1 -0.815</code></pre>
<p>We are ready to create data visualizations, the last of our exploratory
data analysis. Given that the outcome variable <code>fert_rate</code> and
explanatory variable <code>life_exp</code> are both numerical, we can create a
scatterplot to display their relationship, as we did in Figure
<a href="regression.html#fig:numxplot1">5.2</a>. But this time, we incorporate the categorical
variable <code>income</code> by <code>mapping</code> this variable to the <code>color</code> aesthetic,
thereby creating a <em>colored</em> scatterplot.</p>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">UN_data_ch6</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">life_exp</span>, y <span class="op">=</span> <span class="va">fert_rate</span>, color <span class="op">=</span> <span class="va">income</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Life Expectancy"</span>, y <span class="op">=</span> <span class="st">"Fertility Rate"</span>, color <span class="op">=</span> <span class="st">"Income group"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:numxcatxplot1"></span>
<img src="ModernDive_files/figure-html/numxcatxplot1-1.png" alt="Colored scatterplot of life expectancy and fertility rate." width="\textwidth"><p class="caption">
FIGURE 6.1: Colored scatterplot of life expectancy and fertility rate.
</p>
</div>
<p>In the resulting Figure <a href="multiple-regression.html#fig:numxcatxplot1">6.1</a>, observe that
<code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> assigns a default color scheme to the points and to the lines
associated with the four levels of <code>income</code>: <code>Low income</code>,
<code>Lower middle income</code>, <code>Upper middle income</code>, and <code>High income</code>.
Furthermore, the <code>geom_smooth(method = "lm", se = FALSE)</code> layer
automatically fits a different regression line for each group.</p>
<p>We can see some interesting trends. First, observe that we get a
different line for each income group. Second, the slopes for all the
income groups are negative. Third, the slope for the <code>High income</code> group
is clearly less steep than the slopes for all other three groups. So,
the changes in fertility rate due to changes in life expectancy are
dependent on the level of income of a given country. Fourth, observe
that high-income countries have, in general, high life expectancy and
low fertility rates.</p>
</div>
<div id="model4interactiontable" class="section level3" number="6.1.2">
<h3>
<span class="header-section-number">6.1.2</span> Model with interactions<a class="anchor" aria-label="anchor" href="#model4interactiontable"><i class="fas fa-link"></i></a>
</h3>
<p>We can represent the four regression lines in Figure
<a href="multiple-regression.html#fig:numxcatxplot1">6.1</a> as a multiple regression model with
<em>interactions</em>. </p>
<p>Before we do this, however, we review a linear regression with only one
categorical explanatory variable. Recall in Subsection
<a href="regression.html#model2table">5.2.2</a> we fit a regression model for each country life
expectancy as a function of the corresponding continent. We produce the
corresponding analysis here, now using the fertility rate as the
response variable and the income group as the categorical explanatory
variable. We’ll use slightly different notation to what was done
previously to make the model more general.</p>
<p>A linear model with a categorical explanatory variable is called a
one-factor model where factor refers to the categorical explanatory
variable and the categories are also called factor levels. We represent
the categories using indicator functions or dummy variables. In our UN
data example, The variable <code>income</code> has four categories or levels:
<code>Low income</code>, <code>Lower middle income</code>, <code>Upper middle income</code>, and
<code>High income</code>. The corresponding dummy variables needed are:</p>
<p><span class="math display">\[
D_1 = \left\{
\begin{array}{ll}
1 &amp; \text{if the UN member state has low income} \phantom{asfdasfd} \\
0 &amp; \text{otherwise}\end{array}
\right.
\]</span>
<span class="math display">\[
D_2 = \left\{
\begin{array}{ll}
1 &amp; \text{if the UN member state has lower middle income} \\
0 &amp; \text{otherwise}\end{array}
\right.
\]</span>
<span class="math display">\[
D_3 = \left\{
\begin{array}{ll}
1 &amp; \text{if the UN member state has high middle income}\phantom{a} \\
0 &amp; \text{otherwise}\end{array}
\right.
\]</span>
<span class="math display">\[
D_4 = \left\{
\begin{array}{ll}
1 &amp; \text{if the UN member state has high income} \phantom{asfdafd}\\
0 &amp; \text{otherwise}\end{array}
\right.\\
\]</span></p>
<p>So, for example, if a given UN member state has <code>Low income</code>, its dummy
variables are <span class="math inline">\(D_1 = 1\)</span> and <span class="math inline">\(D_2 = D_3 = D_4 = 0\)</span>. Similarly, if another
UN member state has <code>High  middle income</code>, then its dummy variables
would be <span class="math inline">\(D_1 = D_2 = D_4 = 0\)</span> and <span class="math inline">\(D_3 = 1\)</span>. Using dummy variables, the
mathematical formulation of the linear regression for our example is:</p>
<p><span class="math display">\[\hat y = \widehat{\text{fert rate}} = b_0 + b_2 D_2 + b_3 D_3 + b_4 D_4\]</span></p>
<p>or if we want to express it in terms of the <span class="math inline">\(i\)</span>th observation in our
dataset, we can include the <span class="math inline">\(i\)</span>th subscript:</p>
<p><span class="math display">\[\hat y_i = \widehat{\text{fert rate}} = b_0 + b_2 D_{2i} + b_3 D_{3i} + b_4 D_{4i}\]</span></p>
<p>Recall that the coefficient <span class="math inline">\(b_0\)</span> represents the intercept and the
coefficients <span class="math inline">\(b_2\)</span>, <span class="math inline">\(b_3\)</span>, and <span class="math inline">\(b_4\)</span> are the offsets based on the
appropriate category. The dummy variables, <span class="math inline">\(D_2\)</span>, <span class="math inline">\(D_3\)</span>, and <span class="math inline">\(D_4\)</span>, take
the values of zero or one depending on the corresponding category of any
given country. Observe also that <span class="math inline">\(D_1\)</span> does not appear in the model. The
reason for this is entirely mathematical: if the model would contain an
intercept and all the dummy variables, the model would be
over-specified, that is, it would contain one redundant explanatory
variable. The solution is to drop one of the variables. We keep the
intercept because it provides flexibility when interpreting more
complicated models, and we drop one of the dummy variables which, by
default in R, is the first dummy variable, <span class="math inline">\(D_1\)</span>. This does not mean
that we are losing information of the first level <span class="math inline">\(D_1\)</span>. If a country is
part of the <code>Low income</code> level, <span class="math inline">\(D_1 = 1\)</span>, <span class="math inline">\(D_2 = D_3 = D_4 = 0\)</span>, so
most of the terms in the regression are zero and the linear regression
becomes:</p>
<p><span class="math display">\[\hat y = \widehat{\text{fert rate}} = b_0\]</span> So the intercept
represents the average fertility rate when the country is a <code>Low income</code>
country. Similarly, if another country is part of the
<code>High middle income</code> level, then <span class="math inline">\(D_1 = D_2 = D_4 = 0\)</span> and <span class="math inline">\(D_3 = 1\)</span> so
the linear regression becomes:</p>
<p><span class="math display">\[\hat y = \widehat{\text{fert rate}} = b_0 + b_3\]</span> The average
fertility rate for a <code>High middle income</code> country is <span class="math inline">\(b_0 + b_3\)</span>.
Observe that <span class="math inline">\(b_3\)</span> is an <em>offset</em> for life expectancy between the
baseline level and the <code>High middle income</code> level. The same logic
applies to the model for each possible income category.</p>
<p>We calculate the regression coefficients using the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> function and the
command <code><a href="https://rdrr.io/r/stats/coef.html">coef()</a></code> to retrieve the coefficients of the linear regression:</p>
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">one_factor_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">fert_rate</span> <span class="op">~</span> <span class="va">income</span>, data <span class="op">=</span> <span class="va">UN_data_ch6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">one_factor_model</span><span class="op">)</span></span></code></pre></div>
<p>We present these results on a table with the mathematical notation used
above:</p>
<div class="inline-table"><table class="table" style="font-size: 16px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Coefficients
</th>
<th style="text-align:right;">
Values
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:left;">
b0
</td>
<td style="text-align:right;">
4.28
</td>
</tr>
<tr>
<td style="text-align:left;">
incomeLower middle income
</td>
<td style="text-align:left;">
b2
</td>
<td style="text-align:right;">
-1.30
</td>
</tr>
<tr>
<td style="text-align:left;">
incomeUpper middle income
</td>
<td style="text-align:left;">
b3
</td>
<td style="text-align:right;">
-2.25
</td>
</tr>
<tr>
<td style="text-align:left;">
incomeHigh income
</td>
<td style="text-align:left;">
b4
</td>
<td style="text-align:right;">
-2.65
</td>
</tr>
</tbody>
</table></div>
<p>The first level, <code>Low income</code>, is the “baseline” group. The average
fertility rate for <code>Low income</code> UN member states is 4.28.
Similarly, the average fertility rate for <code>Upper middle income</code> member
states is 4.28 + -2.25 = 2.03.</p>
<p>We are now ready to study the multiple linear regression model with
interactions shown in Figure <a href="multiple-regression.html#fig:numxcatxplot1">6.1</a>. In this figure we
can identify three different effects. First, for any fixed level of life
expectancy, observe that there are four different fertility rates. They
represent the effect of the categorical explanatory variable, <code>income</code>.
Second, for any given regression line, the slope represents the change
in average fertility rate due to changes on life expectancy. This is the
effect of the numerical explanatory variable <code>life_exp</code>. Third, observe
that the slope of the line depends on the income level; as an
illustration, observe that for <code>High income</code> member states the slope is
less steep than for <code>Low income</code> member states. When the slope changes
due to changes in the explanatory variable, we call this an
<strong>interaction</strong> effect.</p>
<p>The mathematical formulation of the linear regression model with two
explanatory variables, one numerical and one categorical, and
interactions is:</p>
<p><span class="math display">\[\begin{aligned}\widehat{y} = \widehat{\text{fert rate}} = b_0
&amp;+ b_{02}D_2 + b_{03}D_3 + b_{04}D_4 \\
&amp;+ b_1x \\
&amp;+ b_{12}xD_2 + b_{13}xD_3 + b_{14}xD_4\end{aligned}\]</span></p>
<p>The linear regression shows how the average life expectancy is affected
by the categorical variable, the numerical variable, and the interaction
effects. There are eight coefficients in our model and we have separated
their coefficients into three lines to highlight their different roles.
The first line shows the intercept and the effects of the categorical
explanatory variables. Recall that <span class="math inline">\(D_2\)</span>, <span class="math inline">\(D_3\)</span>, and <span class="math inline">\(D_4\)</span> are the dummy
variables in the model and each is equal to one or zero depending on the
category of the country at hand; correspondingly, the coefficients
<span class="math inline">\(b_{02}\)</span>, <span class="math inline">\(b_{03}\)</span>, and <span class="math inline">\(b_{04}\)</span> are the offsets with respect to the
baseline level of the intercept, <span class="math inline">\(b_0\)</span>. Recall that the first dummy
variable has been dropped and the intercept captures this effect. The
second line in the equation represents the effect of the numerical
variable, <span class="math inline">\(x\)</span>. In our example <span class="math inline">\(x\)</span> is the value of life expectancy. The
coefficient <span class="math inline">\(b_1\)</span> is the slope of the line and represents the change in
fertility rate due to one unit change in life expectancy. The third line
in the equation represents the interaction effects on the slopes.
Observe that they are a combination of life expectancy, <span class="math inline">\(x\)</span>, and income
level, <span class="math inline">\(D_2\)</span>, <span class="math inline">\(D_3\)</span>, and <span class="math inline">\(D_4\)</span>. What these interaction effects do is to
modify the slope for different levels of income. For a
<code>Low income</code> member state, the dummy variables are <span class="math inline">\(D_1 = 1\)</span>,
<span class="math inline">\(D_2 = D_3 = D_4 = 0\)</span> and our linear regression is:</p>
<p><span class="math display">\[\begin{aligned}\widehat{y} = \widehat{\text{fert rate}} &amp;= b_0 + b_{02}\cdot 0 + b_{03}\cdot 0 + b_{04}\cdot 0 + b_1x + b_{12}x\cdot 0 + b_{13}x\cdot 0 + b_{14}x\cdot 0\\
&amp; = b_0 + b_1x \end{aligned}\]</span></p>
<p>Similarly, for a <code>High income</code> member state, the dummy variables are
<span class="math inline">\(D_1 = D_2 =D_3 = 0\)</span>, and <span class="math inline">\(D_4 = 1\)</span>. We take into account the offsets
for the intercept, <span class="math inline">\(b_{04}\)</span>, and the slope, <span class="math inline">\(b_{14}\)</span>, and the linear
regression becomes:</p>
<p><span class="math display">\[\begin{aligned}\widehat{y} = \widehat{\text{fert rate}} &amp;= b_0 + b_{02}\cdot 0 + b_{03}\cdot 0 + b_{04}\cdot 1 + b_1 x  + b_{12}x\cdot 0 + b_{13}x\cdot 0 + b_{14}x\cdot 1\\
&amp; = b_0 + b_{04} +  b_1x + b_{14}x\\
&amp; = (b_0 + b_{04}) + (b_1 + b_{14})\cdot x\end{aligned}\]</span></p>
<p>Observe how the intercept and the slope are different for a
<code>High income</code> member state when compared to the baseline <code>Low income</code>
member state. As an illustration, we construct this multiple linear
regression for the UN member state dataset in R. We first “fit” the
model using the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> “linear model” function and then find the
coefficients using the function <code><a href="https://rdrr.io/r/stats/coef.html">coef()</a></code>. In R, the formula used is
<code>y ~ x1 + x2 + x1:x2</code> where <code>x1</code> and <code>x2</code> are the variable names in the
dataset and represent the main effects while <code>x1:x2</code> is the interaction
term. For simplicity, we can also write <code>y ~ x1 * x2</code> as the <code>*</code> sign
accounts for both, main effects and interaction effects. R would let
both <code>x1</code> and <code>x2</code> be either explanatory or numerical, and we need to
make sure the dataset format is appropriate for the regression we want
to run. Here is the code for our example:</p>
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit regression model and get the coefficients of the model</span></span>
<span><span class="va">model_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">fert_rate</span> <span class="op">~</span> <span class="va">life_exp</span> <span class="op">*</span> <span class="va">income</span>, data <span class="op">=</span> <span class="va">UN_data_ch6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">model_int</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table" style="font-size: 16px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:regtable-interaction">TABLE 6.2: </span>Regression table for interaction model
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Coefficients
</th>
<th style="text-align:right;">
Values
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:left;">
b0
</td>
<td style="text-align:right;">
11.918
</td>
</tr>
<tr>
<td style="text-align:left;">
incomeLower middle income
</td>
<td style="text-align:left;">
b02
</td>
<td style="text-align:right;">
-1.504
</td>
</tr>
<tr>
<td style="text-align:left;">
incomeUpper middle income
</td>
<td style="text-align:left;">
b03
</td>
<td style="text-align:right;">
-1.893
</td>
</tr>
<tr>
<td style="text-align:left;">
incomeHigh income
</td>
<td style="text-align:left;">
b04
</td>
<td style="text-align:right;">
-6.580
</td>
</tr>
<tr>
<td style="text-align:left;">
life_exp
</td>
<td style="text-align:left;">
b1
</td>
<td style="text-align:right;">
-0.118
</td>
</tr>
<tr>
<td style="text-align:left;">
incomeLower middle income:life_exp
</td>
<td style="text-align:left;">
b12
</td>
<td style="text-align:right;">
0.013
</td>
</tr>
<tr>
<td style="text-align:left;">
incomeUpper middle income:life_exp
</td>
<td style="text-align:left;">
b13
</td>
<td style="text-align:right;">
0.011
</td>
</tr>
<tr>
<td style="text-align:left;">
incomeHigh income:life_exp
</td>
<td style="text-align:left;">
b14
</td>
<td style="text-align:right;">
0.072
</td>
</tr>
</tbody>
</table></div>
<p>We can match the coefficients with the values computed in Table <a href="multiple-regression.html#tab:regtable-interaction">6.2</a>: the fitted
fertility rate <span class="math inline">\(\widehat{y} = \widehat{\text{fert rate}}\)</span> for
<code>Low income</code> countries is</p>
<p><span class="math display">\[\widehat{\text{fert rate}} = b_0 + b_1\cdot x = 11.92 + (-0.12)\cdot x,\]</span></p>
<p>which is the equation of the regression line in Figure
<a href="multiple-regression.html#fig:numxcatxplot1">6.1</a> for low income countries. The regression has an
intercept of 11.92 and a slope of -0.12. Since life
expectancy is greater than zero for all countries, the intercept has no
practical interpretation and we only need it to produce the most
appropriate line. The interpretation of the slope is: for
<code>Low income</code> countries, every additional year of life expectancy reduces
the average fertility rate by 0.12 units.</p>
<p>As discussed earlier, the intercept and slope for all the other income
groups are determined by taking into account the appropriate offsets. For
example, for <code>High income</code> countries <span class="math inline">\(D_4 = 1\)</span> and all other
dummy variables are equal to zero. The regression line becomes</p>
<p><span class="math display">\[\widehat{y} = \widehat{\text{fert rate}} = b_0 + b_1x + b_{04} + b_{14}x = (b_0 + b_{04} ) + (b_1+b_{14})x \]</span></p>
<p>where <span class="math inline">\(x\)</span> is life expectancy, <code>life_exp</code>. The intercept is
<code>(Intercept) + incomeHigh income</code>:</p>
<p><span class="math display">\[b_0 + b_{04} = 11.92 +(-6.58) = 5.34,\]</span></p>
<p>and the slope for these <code>High income</code> countries is
<code>life_exp + life_exp:incomeHigh income</code> corresponding to</p>
<p><span class="math display">\[b_1 + b_{14}=  -0.12 + 0.07 = -0.05.\]</span></p>
<p>For <code>High income</code> countries, every additional year of life expectancy
reduces the average fertility rate by 0.05
units. The intercepts and slopes for other income levels are calculated
similarly.</p>
<p>Since the life expectancy for <code>Low income</code> countries has a steeper slope
than <code>High income</code> countries, one additional year of life expectancy
will decrease fertility rates more for the low-income group than for the
high-income group. This is consistent with our observation from Figure
<a href="multiple-regression.html#fig:numxcatxplot1">6.1</a>. When the associated effect of one variable
<em>depends on the value of another variable</em> we say that there is an
interaction effect. This is the reason why the regression slopes are
different for different income groups.</p>
<div class="learncheck">
<p>
<strong><em>Learning check</em></strong>
</p>
</div>
<p><strong>(LC6.1)</strong> What is the goal of including an interaction term in a multiple regression model?</p>
<ul>
<li>A. To create more variables for analysis.</li>
<li>B. To account for the effect of one explanatory variable on the response while considering the influence of another explanatory variable.</li>
<li>C. To make the model more complex without any real benefit.</li>
<li>D. To automatically improve the fit of the regression line.</li>
</ul>
<p><strong>(LC6.2)</strong> How does the inclusion of both main effects and interaction terms in a regression model affect the interpretation of individual coefficients?</p>
<ul>
<li>A. They represent simple marginal effects.</li>
<li>B. They become meaningless.</li>
<li>C. They are conditional effects, depending on the level of the interacting variables.</li>
<li>D. They are interpreted in the same way as in models without interactions.</li>
</ul>
<p><strong>(LC6.3)</strong> Which statement about the use of dummy variables in regression models is correct?</p>
<ul>
<li>A. Dummy variables are used to represent numerical variables.</li>
<li>B. Dummy variables are used to represent categorical variables at least two levels.</li>
<li>C. Dummy variables always decrease the R-squared value.</li>
<li>D. Dummy variables are unnecessary in regression models.</li>
</ul>
<div class="learncheck">

</div>
</div>
<div id="model4table" class="section level3" number="6.1.3">
<h3>
<span class="header-section-number">6.1.3</span> Model without interactions<a class="anchor" aria-label="anchor" href="#model4table"><i class="fas fa-link"></i></a>
</h3>
<p>We can simplify the previous model by removing the interaction effects.
The model still represents different income groups with different
regression lines by allowing different intercepts but all the lines have
the same slope: they are parallel as shown
in Figure <a href="multiple-regression.html#fig:numxcatx-parallel">6.2</a>.</p>
<p>To plot parallel slopes we use the function
<a href="https://moderndive.github.io/moderndive/reference/geom_parallel_slopes.html"><code>geom_parallel_slopes()</code></a>
that is included in the <code>moderndive</code> package. To use this function you need
to load both the <code>ggplot2</code> and <code>moderndive</code> packages. Observe how the
code is identical to the one used for the model with interactions in
Figure <a href="multiple-regression.html#fig:numxcatxplot1">6.1</a>, but now the
<code>geom_smooth(method = "lm", se = FALSE)</code> layer is replaced with
<code>geom_parallel_slopes(se = FALSE)</code>.</p>
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">UN_data_ch6</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">life_exp</span>, y <span class="op">=</span> <span class="va">fert_rate</span>, color <span class="op">=</span> <span class="va">income</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Life expectancy"</span>, y <span class="op">=</span> <span class="st">"Fertility rate"</span>, color <span class="op">=</span> <span class="st">"Income group"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="moderndive.github.io/moderndive/reference/geom_parallel_slopes.html">geom_parallel_slopes</a></span><span class="op">(</span>se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:numxcatx-parallel"></span>
<img src="ModernDive_files/figure-html/numxcatx-parallel-1.png" alt="Parallel slopes model of fertility rate with life expectancy and income." width="\textwidth"><p class="caption">
FIGURE 6.2: Parallel slopes model of fertility rate with life expectancy and income.
</p>
</div>
<p>The regression lines for each income group are shown in Figure
<a href="multiple-regression.html#fig:numxcatx-parallel">6.2</a>. Observe that the lines are now parallel:
they all have the same negative slope. The interpretation of this result
is that the change in fertility rate due to changes in life expectancy
in a given country are the same regardless the income group of this
country.</p>
<p>On the other hand, any two regression lines in Figure
<a href="multiple-regression.html#fig:numxcatx-parallel">6.2</a> have different intercepts representing the
income group; in particular, observe that for any fixed level of life
expectancy the fertility rate is greater for <code>Low income</code> and
<code>Lower middle income</code> countries than for <code>Upper middle income</code> and
<code>High income</code> countries.</p>
<p>The mathematical formulation of the linear regression model with two
explanatory variables, one numerical and one categorical, and without
interactions is:</p>
<p><span class="math display">\[\widehat{y} = b_0 + b_{02}D_2 + b_{03}D_3 + b_{04}D_4+ b_1x.\]</span> Observe
that the dummy variables only affect the intercept now, and the slope is
fully described by <span class="math inline">\(b_1\)</span> for any income group. In the UN data example, a
<code>High income</code> country, with <span class="math inline">\(D_4 = 1\)</span> and the other dummy variables
equal to zero, will be represented by</p>
<p><span class="math display">\[\widehat{y} = (b_0 + b_{04})+ b_1x.\]</span></p>
<p>To find the coefficients for this regression in R, the formula used is
<code>y ~ x1 + x2</code> where <code>x1</code> and <code>x2</code> are the variable names in the dataset
and represent the main effects. Observe that the term <code>x1:x2</code>
representing the interaction is no longer included. R would let both
<code>x1</code> and <code>x2</code> to be either explanatory or numerical; therefore, we
should always check that the variable format is appropriate for the
regression we want to run. Here is the code for the UN data example:</p>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit regression model:</span></span>
<span><span class="va">model_no_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">fert_rate</span> <span class="op">~</span> <span class="va">life_exp</span> <span class="op">+</span> <span class="va">income</span>, data <span class="op">=</span> <span class="va">UN_data_ch6</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the coefficients of the model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">model_no_int</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table" style="font-size: 16px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:regtable-parallel1">TABLE 6.3: </span>Regression table for a model without interactions
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Coefficients
</th>
<th style="text-align:right;">
Values
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:left;">
b0
</td>
<td style="text-align:right;">
10.768
</td>
</tr>
<tr>
<td style="text-align:left;">
incomeLower middle income
</td>
<td style="text-align:left;">
b02
</td>
<td style="text-align:right;">
-0.719
</td>
</tr>
<tr>
<td style="text-align:left;">
incomeUpper middle income
</td>
<td style="text-align:left;">
b03
</td>
<td style="text-align:right;">
-1.239
</td>
</tr>
<tr>
<td style="text-align:left;">
incomeHigh income
</td>
<td style="text-align:left;">
b04
</td>
<td style="text-align:right;">
-1.067
</td>
</tr>
<tr>
<td style="text-align:left;">
life_exp
</td>
<td style="text-align:left;">
b1
</td>
<td style="text-align:right;">
-0.101
</td>
</tr>
</tbody>
</table></div>
<p>In this model without interactions presented in Table
<a href="multiple-regression.html#tab:regtable-parallel1">6.3</a>, the slope is the same for all the
regression lines, <span class="math inline">\(b_1 = -0.101\)</span>. Assuming that this model is
correct, for any UN member state, every additional year of life
expectancy reduces the average fertility rate by 0.101
units, regardless of the income level of the member state. The intercept
of the regression line for <code>Low income</code> member states is
10.768 while for <code>High income</code> member states is
<span class="math inline">\(10.768 + (-1.067) = 9.701\)</span>.
The intercepts for other income levels can be determined similarly. We
compare the visualizations for both models side-by-side in Figure
<a href="multiple-regression.html#fig:numxcatx-comparison">6.3</a>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:numxcatx-comparison"></span>
<img src="ModernDive_files/figure-html/numxcatx-comparison-1.png" alt="Comparison of interaction and parallel slopes models." width="\textwidth"><p class="caption">
FIGURE 6.3: Comparison of interaction and parallel slopes models.
</p>
</div>
<p>Which one is the preferred model? Looking at the scatterplot and the
clusters of points in Figure <a href="multiple-regression.html#fig:numxcatx-comparison">6.3</a>, it does
appear that lines with different slopes capture better the behavior of
different groups of points. The lines do not appear to be parallel and
the interaction model seems more appropriate.</p>
<div class="learncheck">
<p>
<strong><em>Learning check</em></strong>
</p>
</div>
<p><strong>(LC6.4)</strong> How should a model with one categorical regressor and one numerical regressor, but no interactions, be interpreted?</p>
<ul>
<li>A. The slope of the model for each category is different.</li>
<li>B. The slope of the model for each category is the same.</li>
<li>C. There is no relationship between the categorical regressor and the response.</li>
<li>D. There is no relationship between the numerical regressor and the response.</li>
</ul>
<div class="learncheck">

</div>
</div>
<div id="model4points" class="section level3" number="6.1.4">
<h3>
<span class="header-section-number">6.1.4</span> Observed responses, fitted values, and residuals<a class="anchor" aria-label="anchor" href="#model4points"><i class="fas fa-link"></i></a>
</h3>
<p>In this subsection, we work with the regression model with interactions.
The coefficients for this model were found earlier, saved in
<code>model_int</code>, and are displayed in Table <a href="multiple-regression.html#tab:regtable-interaction1">6.4</a>:</p>
<div class="inline-table"><table class="table" style="font-size: 16px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:regtable-interaction1">TABLE 6.4: </span>Regression table for interaction model
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Coefficients
</th>
<th style="text-align:right;">
Values
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:left;">
b0
</td>
<td style="text-align:right;">
11.918
</td>
</tr>
<tr>
<td style="text-align:left;">
incomeLower middle income
</td>
<td style="text-align:left;">
b02
</td>
<td style="text-align:right;">
-1.504
</td>
</tr>
<tr>
<td style="text-align:left;">
incomeUpper middle income
</td>
<td style="text-align:left;">
b03
</td>
<td style="text-align:right;">
-1.893
</td>
</tr>
<tr>
<td style="text-align:left;">
incomeHigh income
</td>
<td style="text-align:left;">
b04
</td>
<td style="text-align:right;">
-6.580
</td>
</tr>
<tr>
<td style="text-align:left;">
life_exp
</td>
<td style="text-align:left;">
b1
</td>
<td style="text-align:right;">
-0.118
</td>
</tr>
<tr>
<td style="text-align:left;">
incomeLower middle income:life_exp
</td>
<td style="text-align:left;">
b12
</td>
<td style="text-align:right;">
0.013
</td>
</tr>
<tr>
<td style="text-align:left;">
incomeUpper middle income:life_exp
</td>
<td style="text-align:left;">
b13
</td>
<td style="text-align:right;">
0.011
</td>
</tr>
<tr>
<td style="text-align:left;">
incomeHigh income:life_exp
</td>
<td style="text-align:left;">
b14
</td>
<td style="text-align:right;">
0.072
</td>
</tr>
</tbody>
</table></div>
<p>We can use these coefficients to find the fitted values and residuals
for any given observation. As an illustration, we chose two observations
from the UN member states dataset, provided the values for the
explanatory variables and response, as well as the fitted values and
residuals:</p>
<div class="inline-table"><table class="table" style="font-size: 16px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:right;">
ID
</th>
<th style="text-align:right;">
fert_rate
</th>
<th style="text-align:left;">
income
</th>
<th style="text-align:right;">
life_exp
</th>
<th style="text-align:right;">
fert_rate_hat
</th>
<th style="text-align:right;">
residual
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.3
</td>
<td style="text-align:left;">
High income
</td>
<td style="text-align:right;">
79.7
</td>
<td style="text-align:right;">
1.65
</td>
<td style="text-align:right;">
-0.35
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5.7
</td>
<td style="text-align:left;">
Low income
</td>
<td style="text-align:right;">
62.4
</td>
<td style="text-align:right;">
4.52
</td>
<td style="text-align:right;">
1.18
</td>
</tr>
</tbody>
</table></div>
<p>The first observation is a <code>High income</code> country with a life expectancy
of 79.74 years and an observed fertility rate equal to
1.3. The second observation is a <code>Low income</code> country
with a life expectancy of 62.41 years and an observed
fertility rate equal to 5.7 The fitted value, <span class="math inline">\(\hat y\)</span>,
called <code>fert_rate_hat</code> in the table, is the estimated value of the
response determined by the regression line. This value is computed by
using the values of the explanatory variables and the coefficients of
the linear regression. In addition, recall the difference between the
observed response value and the fitted value, <span class="math inline">\(y - \hat y\)</span>, is called
the residual.</p>
<p>We illustrate this in Figure <a href="multiple-regression.html#fig:fitted-values">6.4</a>. The vertical line
on the left represents the life expectancy value for the <code>Low income</code>
country. The y-value for the large dot on the regression line that
intersects the vertical line is the fitted value for fertility rate,
<span class="math inline">\(\widehat y\)</span>, and the y-value for the large dot above the line is the
observed fertility rate, <span class="math inline">\(y\)</span>. The difference between these values,
<span class="math inline">\(y - \widehat y\)</span>, is called the residual and in this case is positive.
Similarly, the vertical line on the right represents the life expectancy
value for the <code>High income</code> country, the y-value for the large dot on
the regression line is the fitted fertility rate. The observed y-value
for fertility rate is below the regression line making the residual
negative.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fitted-values"></span>
<img src="ModernDive_files/figure-html/fitted-values-1.png" alt="Fitted values for two new countries." width="\textwidth"><p class="caption">
FIGURE 6.4: Fitted values for two new countries.
</p>
</div>
<p>We can generalize the study of fitted values and residuals for all the
countries in the <code>UN_data_ch6</code> dataset, as shown in Table
<a href="multiple-regression.html#tab:model4-points-table">6.5</a>.</p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regression_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="moderndive.github.io/moderndive/reference/get_regression_points.html">get_regression_points</a></span><span class="op">(</span><span class="va">model_int</span><span class="op">)</span></span>
<span><span class="va">regression_points</span></span></code></pre></div>
<div class="inline-table"><table class="table" style="font-size: 16px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:model4-points-table">TABLE 6.5: </span>Regression points (First 10 out of 182 countries)
</caption>
<thead><tr>
<th style="text-align:right;">
ID
</th>
<th style="text-align:right;">
fert_rate
</th>
<th style="text-align:left;">
income
</th>
<th style="text-align:right;">
life_exp
</th>
<th style="text-align:right;">
fert_rate_hat
</th>
<th style="text-align:right;">
residual
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4.3
</td>
<td style="text-align:left;">
Low income
</td>
<td style="text-align:right;">
53.6
</td>
<td style="text-align:right;">
5.56
</td>
<td style="text-align:right;">
-1.262
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:left;">
Upper middle income
</td>
<td style="text-align:right;">
79.5
</td>
<td style="text-align:right;">
1.50
</td>
<td style="text-align:right;">
-0.098
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2.7
</td>
<td style="text-align:left;">
Lower middle income
</td>
<td style="text-align:right;">
78.0
</td>
<td style="text-align:right;">
2.16
</td>
<td style="text-align:right;">
0.544
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5.0
</td>
<td style="text-align:left;">
Lower middle income
</td>
<td style="text-align:right;">
62.1
</td>
<td style="text-align:right;">
3.84
</td>
<td style="text-align:right;">
1.159
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1.6
</td>
<td style="text-align:left;">
High income
</td>
<td style="text-align:right;">
77.8
</td>
<td style="text-align:right;">
1.74
</td>
<td style="text-align:right;">
-0.139
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1.9
</td>
<td style="text-align:left;">
Upper middle income
</td>
<td style="text-align:right;">
78.3
</td>
<td style="text-align:right;">
1.62
</td>
<td style="text-align:right;">
0.278
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1.6
</td>
<td style="text-align:left;">
Upper middle income
</td>
<td style="text-align:right;">
76.1
</td>
<td style="text-align:right;">
1.86
</td>
<td style="text-align:right;">
-0.256
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
1.6
</td>
<td style="text-align:left;">
High income
</td>
<td style="text-align:right;">
83.1
</td>
<td style="text-align:right;">
1.50
</td>
<td style="text-align:right;">
0.105
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
1.5
</td>
<td style="text-align:left;">
High income
</td>
<td style="text-align:right;">
82.3
</td>
<td style="text-align:right;">
1.53
</td>
<td style="text-align:right;">
-0.033
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
1.6
</td>
<td style="text-align:left;">
Upper middle income
</td>
<td style="text-align:right;">
74.2
</td>
<td style="text-align:right;">
2.07
</td>
<td style="text-align:right;">
-0.469
</td>
</tr>
</tbody>
</table></div>
<div class="learncheck">
<p>
<strong><em>Learning check</em></strong>
</p>
</div>
<p><strong>(LC6.5)</strong> Compute the
observed response values, fitted values, and residuals for the model
without interactions.</p>
<p><strong>(LC6.6)</strong> What is the main benefit of visualizing the fitted values and residuals of a multiple regression model?</p>
<ul>
<li>A. To find errors in the dataset.</li>
<li>B. To check the assumptions of the regression model, such as linearity and homoscedasticity.</li>
<li>C. To always improve the model’s accuracy.</li>
<li>D. To increase the complexity of the model.</li>
</ul>
<div class="learncheck">

</div>
</div>
</div>
<div id="model3" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> Two numerical explanatory variables<a class="anchor" aria-label="anchor" href="#model3"><i class="fas fa-link"></i></a>
</h2>
<p>We now consider regression models with two numerical explanatory
variables. To illustrate this situation we explore the <code>ISLR2</code> R
package for the first time in this book using
its <code>Credit</code> dataset. This dataset contains
simulated information for 400 customers. For the regression model we use the
credit card balance (<code>Balance</code>) as the response variable; and the credit limit
(<code>Limit</code>), and the income (<code>Income</code>) as the numerical explanatory
variables.</p>
<div id="model3EDA" class="section level3" number="6.2.1">
<h3>
<span class="header-section-number">6.2.1</span> Exploratory data analysis<a class="anchor" aria-label="anchor" href="#model3EDA"><i class="fas fa-link"></i></a>
</h3>
<p>We load the <code>Credit</code> data
frame and to ensure the type of
behavior we have become accustomed to in using the <code>tidyverse</code>, we also
convert this data frame to be a <code>tibble</code> using <code><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble()</a></code>. We construct a new
data frame <code>credit_ch6</code> with only the variables needed.
We do this by using the <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> verb as we did in Subsection <a href="wrangling.html#select">3.8.1</a>
and, in addition, we save the selecting variables with different names:
<code>Balance</code> becomes <code>debt</code>, <code>Limit</code> becomes <code>credit_limit</code>, and <code>Income</code>
becomes <code>income</code>:</p>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.statlearning.com">ISLR2</a></span><span class="op">)</span></span>
<span><span class="va">credit_ch6</span> <span class="op">&lt;-</span> <span class="va">Credit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>debt <span class="op">=</span> <span class="va">Balance</span>, credit_limit <span class="op">=</span> <span class="va">Limit</span>, </span>
<span>         income <span class="op">=</span> <span class="va">Income</span>, credit_rating <span class="op">=</span> <span class="va">Rating</span>, age <span class="op">=</span> <span class="va">Age</span><span class="op">)</span></span></code></pre></div>
<p>You can observe the effect of our use of <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> by looking at the
raw values either in RStudio’s spreadsheet viewer or by using
<code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code>.</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">credit_ch6</span><span class="op">)</span></span></code></pre></div>
<pre><code>Rows: 400
Columns: 5
$ debt          &lt;dbl&gt; 333, 903, 580, 964, 331, 1151, 203, 872, 279, 1350, 1407, 0, 204, 1081, 148, 0, 0, 368, 891, 104…
$ credit_limit  &lt;dbl&gt; 3606, 6645, 7075, 9504, 4897, 8047, 3388, 7114, 3300, 6819, 8117, 1311, 5308, 6922, 3291, 2525, …
$ income        &lt;dbl&gt; 14.9, 106.0, 104.6, 148.9, 55.9, 80.2, 21.0, 71.4, 15.1, 71.1, 63.1, 15.0, 80.6, 43.7, 19.1, 20.…
$ credit_rating &lt;dbl&gt; 283, 483, 514, 681, 357, 569, 259, 512, 266, 491, 589, 138, 394, 511, 269, 200, 286, 339, 448, 4…
$ age           &lt;dbl&gt; 34, 82, 71, 36, 68, 77, 37, 87, 66, 41, 30, 64, 57, 49, 75, 57, 73, 69, 28, 44, 63, 72, 61, 48, …</code></pre>
<p>Furthermore, we present a random sample of five out of the
400 credit card holders in Table
<a href="multiple-regression.html#tab:model3-data-preview">6.6</a>. As observed before, each time you run
this code, a different subset of five rows is given.</p>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">credit_ch6</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table" style="font-size: 16px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:model3-data-preview">TABLE 6.6: </span>Random sample of 5 credit card holders
</caption>
<thead><tr>
<th style="text-align:right;">
debt
</th>
<th style="text-align:right;">
credit_limit
</th>
<th style="text-align:right;">
income
</th>
<th style="text-align:right;">
credit_rating
</th>
<th style="text-align:right;">
age
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1402
</td>
<td style="text-align:right;">
27.2
</td>
<td style="text-align:right;">
128
</td>
<td style="text-align:right;">
67
</td>
</tr>
<tr>
<td style="text-align:right;">
1081
</td>
<td style="text-align:right;">
6922
</td>
<td style="text-align:right;">
43.7
</td>
<td style="text-align:right;">
511
</td>
<td style="text-align:right;">
49
</td>
</tr>
<tr>
<td style="text-align:right;">
1237
</td>
<td style="text-align:right;">
7499
</td>
<td style="text-align:right;">
58.0
</td>
<td style="text-align:right;">
560
</td>
<td style="text-align:right;">
67
</td>
</tr>
<tr>
<td style="text-align:right;">
379
</td>
<td style="text-align:right;">
4742
</td>
<td style="text-align:right;">
57.1
</td>
<td style="text-align:right;">
372
</td>
<td style="text-align:right;">
79
</td>
</tr>
<tr>
<td style="text-align:right;">
1151
</td>
<td style="text-align:right;">
8047
</td>
<td style="text-align:right;">
80.2
</td>
<td style="text-align:right;">
569
</td>
<td style="text-align:right;">
77
</td>
</tr>
</tbody>
</table></div>
<p>Note that income is in thousands of dollars while debt and credit limit
are in dollars. We can also compute summary statistics using the
<code><a href="moderndive.github.io/moderndive/reference/tidy_summary.html">tidy_summary()</a></code> function. We only <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> the columns of interest
for our model as shown in Table <a href="multiple-regression.html#tab:credittable">6.7</a>:</p>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">credit_ch6</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">debt</span>, <span class="va">credit_limit</span>, <span class="va">income</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="moderndive.github.io/moderndive/reference/tidy_summary.html">tidy_summary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table" style="font-size: 16px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:credittable">TABLE 6.7: </span>Summary of credit data
</caption>
<thead><tr>
<th style="text-align:left;">
column
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:left;">
group
</th>
<th style="text-align:left;">
type
</th>
<th style="text-align:right;">
min
</th>
<th style="text-align:right;">
Q1
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
median
</th>
<th style="text-align:right;">
Q3
</th>
<th style="text-align:right;">
max
</th>
<th style="text-align:right;">
sd
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
debt
</td>
<td style="text-align:right;">
400
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
68.8
</td>
<td style="text-align:right;">
520.0
</td>
<td style="text-align:right;">
459.5
</td>
<td style="text-align:right;">
863.0
</td>
<td style="text-align:right;">
1999
</td>
<td style="text-align:right;">
459.8
</td>
</tr>
<tr>
<td style="text-align:left;">
credit_limit
</td>
<td style="text-align:right;">
400
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:right;">
855.0
</td>
<td style="text-align:right;">
3088.0
</td>
<td style="text-align:right;">
4735.6
</td>
<td style="text-align:right;">
4622.5
</td>
<td style="text-align:right;">
5872.8
</td>
<td style="text-align:right;">
13913
</td>
<td style="text-align:right;">
2308.2
</td>
</tr>
<tr>
<td style="text-align:left;">
income
</td>
<td style="text-align:right;">
400
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:right;">
10.4
</td>
<td style="text-align:right;">
21.0
</td>
<td style="text-align:right;">
45.2
</td>
<td style="text-align:right;">
33.1
</td>
<td style="text-align:right;">
57.5
</td>
<td style="text-align:right;">
187
</td>
<td style="text-align:right;">
35.2
</td>
</tr>
</tbody>
</table></div>
<p>The mean and median credit card <code>debt</code> are $520.0 and $459.5,
respectively. The first quartile for <code>debt</code> is 68.8; this means that 25%
of card holders had debts of $68.80 or less. Correspondingly, the mean
and median credit card limit, <code>credit_limit</code>, are around $4,736 and
$4,622, respectively. Note also that the third quartile of <code>income</code> is
57.5; so 75% of card holders had incomes below $57,500.</p>
<p>We visualize the relationship of the response variable with each of the
two explanatory variables using this R code. These plots are shown
in Figure <a href="multiple-regression.html#fig:2numxplot1">6.5</a>.</p>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">credit_ch6</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">credit_limit</span>, y <span class="op">=</span> <span class="va">debt</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Credit limit (in $)"</span>, y <span class="op">=</span> <span class="st">"Credit card debt (in $)"</span>, </span>
<span>       title <span class="op">=</span> <span class="st">"Debt and credit limit"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">credit_ch6</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">income</span>, y <span class="op">=</span> <span class="va">debt</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Income (in $1000)"</span>, y <span class="op">=</span> <span class="st">"Credit card debt (in $)"</span>, </span>
<span>       title <span class="op">=</span> <span class="st">"Debt and income"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:2numxplot1"></span>
<img src="ModernDive_files/figure-html/2numxplot1-1.png" alt="Relationship between credit card debt and credit limit/income." width="\textwidth"><p class="caption">
FIGURE 6.5: Relationship between credit card debt and credit limit/income.
</p>
</div>
<p>The left plot in Figure <a href="multiple-regression.html#fig:2numxplot1">6.5</a> shows a positive and
linear association between credit limit and credit card debt: as credit
limit increases so does credit card debt. Observe also that many
customers have no credit card debt and there is a cluster of points at
the credit card debt value of zero. The right plot in Figure
<a href="multiple-regression.html#fig:2numxplot1">6.5</a> shows also positive and somewhat linear
association between income and credit card debt, but this association
seems weaker and actually appears positive only for incomes larger than
$50,000. For lower income values it is not clear there is any
association at all.</p>
<p>Since variables <code>debt</code>, <code>credit_limit</code>, and <code>income</code> are numerical, and
more importantly, the associations between the response and explanatory
variables appear to be linear or close to linear, we can also calculate the
correlation coefficient between any two of these variables. Recall that
the correlation coefficient is appropriate if the association between
the variables is linear. One way to do this is using the
<code><a href="moderndive.github.io/moderndive/reference/get_correlation.html">get_correlation()</a></code> command as seen in Subsection <a href="regression.html#model1EDA">5.1.1</a>, once
for each explanatory variable with the response <code>debt</code>:</p>
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">credit_ch6</span> <span class="op">|&gt;</span> <span class="fu"><a href="moderndive.github.io/moderndive/reference/get_correlation.html">get_correlation</a></span><span class="op">(</span><span class="va">debt</span> <span class="op">~</span> <span class="va">credit_limit</span><span class="op">)</span></span>
<span><span class="va">credit_ch6</span> <span class="op">|&gt;</span> <span class="fu"><a href="moderndive.github.io/moderndive/reference/get_correlation.html">get_correlation</a></span><span class="op">(</span><span class="va">debt</span> <span class="op">~</span> <span class="va">income</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, using the <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> verb and command <code><a href="https://rdrr.io/r/stats/cor.html">cor()</a></code> we can
find all correlations simultaneously by returning a <em>correlation
matrix</em> as shown in Table <a href="multiple-regression.html#tab:model3-correlation">6.8</a>.
This matrix shows the correlation
coefficient for any pair of variables in the appropriate row/column
combination.</p>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">credit_ch6</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">debt</span>, <span class="va">credit_limit</span>, <span class="va">income</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table" style="font-size: 16px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:model3-correlation">TABLE 6.8: </span>Correlation coefficients between credit card debt, credit limit, and income
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
debt
</th>
<th style="text-align:right;">
credit_limit
</th>
<th style="text-align:right;">
income
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
debt
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.862
</td>
<td style="text-align:right;">
0.464
</td>
</tr>
<tr>
<td style="text-align:left;">
credit_limit
</td>
<td style="text-align:right;">
0.862
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.792
</td>
</tr>
<tr>
<td style="text-align:left;">
income
</td>
<td style="text-align:right;">
0.464
</td>
<td style="text-align:right;">
0.792
</td>
<td style="text-align:right;">
1.000
</td>
</tr>
</tbody>
</table></div>
<p>Let’s look at some findings presented in the correlation matrix:</p>
<ol style="list-style-type: decimal">
<li>The diagonal values are all 1 because, based on the definition of
the correlation coefficient, the correlation of a variable with
itself is always 1.</li>
<li>The correlation between <code>debt</code> and <code>credit_limit</code> is 0.862. This
indicates a strong and positive linear relationship: the greater the
credit limit is, the larger is the credit card debt, on average.</li>
<li>The correlation between <code>debt</code> and <code>income</code> is 0.464. The linear
relationship is positive albeit somewhat weak. In other words,
higher income is only weakly associated with higher debt.</li>
<li>Observe also that the correlation coefficient between the two
explanatory variables, <code>credit_limit</code> and <code>income</code>, is 0.792.</li>
</ol>
<p>A useful property of the correlation
coefficient is that it is <em>invariant to
linear transformations</em>; this means that the correlation between two
variables, <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>, will be the same as the correlation between
<span class="math inline">\((a\cdot x + b)\)</span> and <span class="math inline">\(y\)</span> for any constants <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>. To illustrate
this, observe that the correlation coefficient between <code>income</code> in
<em>thousands of dollars</em> and credit card <code>debt</code> was 0.464. If we now find
the correlation income in <em>dollars</em>, by multiplying <code>income</code> by 1000,
and credit card <code>debt</code> we get:</p>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">credit_ch6</span> <span class="op">|&gt;</span> <span class="fu"><a href="moderndive.github.io/moderndive/reference/get_correlation.html">get_correlation</a></span><span class="op">(</span><span class="va">debt</span> <span class="op">~</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">income</span><span class="op">)</span></span></code></pre></div>
<pre><code># A tibble: 1 × 1
    cor
  &lt;dbl&gt;
1 0.464</code></pre>
<p>The correlation is exactly the same.</p>
<p>We return to our exploratory data analysis of the multiple regression.
The plots in Figure <a href="multiple-regression.html#fig:2numxplot1">6.5</a> correspond to the
response and each of the explanatory variables <em>separately</em>. In
Figure <a href="multiple-regression.html#fig:3D-scatterplot">6.6</a> we show a 3-dimensional (3D)
scatterplot representing the <em>joint</em> relationship of all three variables
simultaneously. Each of the 400 observations in the
<code>credit_ch6</code> data frame are marked with a
blue point where</p>
<ol style="list-style-type: decimal">
<li>The response variable <span class="math inline">\(y\)</span>, <code>debt</code>, is on the vertical axis.</li>
<li>The regressors <span class="math inline">\(x_1\)</span>, <code>income</code>, and <span class="math inline">\(x_2\)</span>, <code>credit_limit</code>, are on
the two axes that form the bottom plane.</li>
</ol>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:3D-scatterplot"></span>
<img src="images/ISLR2-credit_card_balance_regression_plane.png" alt="3D scatterplot and regression plane." width="60%"><p class="caption">
FIGURE 6.6: 3D scatterplot and regression plane.
</p>
</div>
<p>In addition, Figure <a href="multiple-regression.html#fig:3D-scatterplot">6.6</a> includes a <em>regression
plane</em>. Recall from Subsection
<a href="regression.html#leastsquares">5.3.2</a> that the linear regression with one numerical
explanatory variable selects the “best-fitting” line: the line that
minimizes the <em>sum of squared
residuals</em>. When linear regression is
performed with two numerical explanatory variables, the solution is a
“best-fitting” plane: the plane that minimizes the sum of squared
residuals. Visit <a href="https://moderndive.com/v2/regression-plane-ISLR2.html">this
website</a> to open an
interactive version of this plot in your browser.</p>
<div class="learncheck">
<p>
<strong><em>Learning check</em></strong>
</p>
</div>
<p><strong>(LC6.7)</strong> Conduct a new
exploratory data analysis with the same outcome variable <span class="math inline">\(y\)</span> <code>debt</code> but
with <code>credit_rating</code> and <code>age</code> as the new explanatory variables <span class="math inline">\(x_1\)</span>
and <span class="math inline">\(x_2\)</span>. What can you say about the relationship between a credit card
holder’s debt and their credit rating and age?</p>
<div class="learncheck">

</div>
</div>
<div id="model3table" class="section level3" number="6.2.2">
<h3>
<span class="header-section-number">6.2.2</span> Multiple regression with two numerical regressors<a class="anchor" aria-label="anchor" href="#model3table"><i class="fas fa-link"></i></a>
</h3>
<p>As shown in Figure <a href="multiple-regression.html#fig:3D-scatterplot">6.6</a>, the linear regression with
two numerical regressors produces the “best-fitting” plane. We start
with a model with no interactions for the two numerical explanatory
variables <code>income</code> and <code>credit_limit</code>. In R we consider a model fit with
a formula of the form <code>y ~ x1 + x2</code>. We retrieve the regression
coefficients using the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> function and the command <code><a href="https://rdrr.io/r/stats/coef.html">coef()</a></code> to
get the coefficients of the linear regression. The regression
coefficients are shown in what follows.</p>
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">debt_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">debt</span> <span class="op">~</span> <span class="va">credit_limit</span> <span class="op">+</span> <span class="va">income</span>, data <span class="op">=</span> <span class="va">credit_ch6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">debt_model</span><span class="op">)</span></span></code></pre></div>
<p>We present these results in a table with the mathematical notation used
above:</p>
<div class="inline-table"><table class="table" style="font-size: 16px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Coefficients
</th>
<th style="text-align:right;">
Values
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:left;">
b0
</td>
<td style="text-align:right;">
-385.179
</td>
</tr>
<tr>
<td style="text-align:left;">
credit_limit
</td>
<td style="text-align:left;">
b1
</td>
<td style="text-align:right;">
0.264
</td>
</tr>
<tr>
<td style="text-align:left;">
income
</td>
<td style="text-align:left;">
b2
</td>
<td style="text-align:right;">
-7.663
</td>
</tr>
</tbody>
</table></div>
<ol style="list-style-type: decimal">
<li>We determine the linear regression coefficients using
<code>lm(y ~ x1 + x2, data)</code> where <code>x1</code> and <code>x2</code> are the two numerical
explanatory variables used.</li>
<li>We extract the coefficients from the output using the <code><a href="https://rdrr.io/r/stats/coef.html">coef()</a></code>
command.</li>
</ol>
<p>Let’s interpret the coefficients. The <code>intercept</code> value is
-$385.179. If the range of values that the regressors could take
include a <code>credit_limit</code> of $0 and an <code>income</code> of $0, the intercept
would represent the average credit card debt for an individual with
those levels of <code>credit_limit</code> and <code>income</code>. This is not the case in our
data and the intercept has no practical interpretation; it is mainly
used to determine where the plane should cut the <span class="math inline">\(y\)</span>-intercept to
produce the smallest sum of squared residuals.</p>
<p>Each slope in a multiple linear regression is considered a partial slope
and represents the marginal or additional contribution of a regressor
when it is added to a model that already contains other regressors. This
partial slope is typically different than the slope we may find in a
simple linear regression for the same regressor. The reason is that,
typically, regressors are correlated, so when one regressor is part of a
model, indirectly it’s also explaining part of the other regressor. When
the second regressor is added to the model, it helps explain only
changes in the response that were not already accounted for by the first
regressor. For example, the slope for <code>credit_limit</code> is $0.264. Keeping
<code>income</code> fixed to some value, for an additional increase of credit limit
by one dollar the credit debt increases, on average, by $0.264.
Similarly, the slope of <code>income</code> is -$7.663. Keeping <code>credit_limit</code>
fixed to some level, for a one unit increase of <code>income</code> ($1000 in
actual income), there is an associated decrease of $7.66 in credit card
debt, on average.</p>
<p>Putting these results together, the equation of the regression plane
that gives us fitted values <span class="math inline">\(\widehat{y}\)</span> = <span class="math inline">\(\widehat{\text{debt}}\)</span> is:</p>
<p><span class="math display">\[
\begin{aligned}
\widehat{y} = \widehat{\text{debt}}  &amp;= b_0 + b_1 \cdot x_1 +  b_2 \cdot x_2\\
&amp;= -385.179 + 0.263 \cdot x_1 - 7.663 \cdot x_2
\end{aligned}
\]</span> where <span class="math inline">\(x_1\)</span> represents credit limit and <span class="math inline">\(x_2\)</span> income.</p>
<p>To illustrate the role of partial slopes further, observe that the right
plot in Figure <a href="multiple-regression.html#fig:2numxplot1">6.5</a> shows the relationship between
<code>debt</code> and <code>income</code> in isolation, a <em>positive</em> relationship, so the
slope of income is positive. We can determine the value of this slope by
constructing a simple linear regression using <code>income</code> as the only
regressor:</p>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit regression model and get the coefficients of the model</span></span>
<span><span class="va">simple_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">debt</span> <span class="op">~</span> <span class="va">income</span>, data <span class="op">=</span> <span class="va">credit_ch6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">simple_model</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table" style="font-size: 16px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Coefficients
</th>
<th style="text-align:right;">
Values
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:left;">
b0’
</td>
<td style="text-align:right;">
246.51
</td>
</tr>
<tr>
<td style="text-align:left;">
income
</td>
<td style="text-align:left;">
b2’
</td>
<td style="text-align:right;">
6.05
</td>
</tr>
</tbody>
</table></div>
<p>The regression line is given by the following with the coefficients
denoted using the prime (<span class="math inline">\('\)</span>) designation since they are different values
than what we saw previously</p>
<p><span class="math display">\[
\begin{aligned}
\widehat{y} = \widehat{\text{debt}}  &amp;= b_0' + b_2' \cdot x_2 = 246.515 + 6.048 \cdot x_2
\end{aligned}
\]</span>
where <span class="math inline">\(x_2\)</span> is <code>income</code>. By contrast, when <code>credit_limit</code> and
<code>income</code> are considered <em>jointly</em> to explain changes in <code>debt</code>, the
equation for the multiple linear regression was:</p>
<p><span class="math display">\[
\begin{aligned}
\widehat{y} = \widehat{\text{debt}}  &amp;= b_0 + b_1 \cdot x_1 +  b_2 \cdot x_2\\
&amp;= -385.179 + 0.263 \cdot x_1 - 7.663 \cdot x_2
\end{aligned}
\]</span></p>
<p>So the slope for income in a simple linear regression is 6.048, and
the slope for income in a multiple linear regression is <span class="math inline">\(-7.663\)</span>. As
surprising as these results may appear at first, they are perfectly
valid and consistent as the slope of a simple linear regression has a
different role than the partial slope of a multiple linear regression.
The latter is the additional effect of <code>income</code> on <code>debt</code> when
<code>credit_limit</code> has already been taken into account.</p>
<div class="learncheck">
<p>
<strong><em>Learning check</em></strong>
</p>
</div>
<p><strong>(LC6.8)</strong> Fit a new simple
linear regression using
<code>lm(debt ~ credit_rating + age, data = credit_ch6)</code> where
<code>credit_rating</code> and <code>age</code> are the new numerical explanatory variables
<span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>. Get information about the “best-fitting” regression
plane from the regression table by finding the coefficient of the model.
How do the regression results match up with the results from
your previous exploratory data analysis?</p>
<p><strong>(LC6.9)</strong> Which of the following statements best describes the interpretation of a regression coefficient in a multiple regression model?</p>
<ul>
<li>A. It is the additional effect of a regressor on the response when other regressors have already been taken into account.</li>
<li>B. It is the average response variable value when all explanatory variables are zero.</li>
<li>C. It is always positive if the correlation is strong.</li>
<li>D. It cannot be interpreted if there are more than two explanatory variables.</li>
</ul>
<p><strong>(LC6.10)</strong> What is a characteristic of the “best-fitting” plane in a multiple regression model with two numerical explanatory variables?</p>
<ul>
<li>A. It represents the line of best fit for each explanatory variable separately.</li>
<li>B. It minimizes the product of residuals.</li>
<li>C. It minimizes the sum of squared residuals for all combinations of regressors.</li>
<li>D. It shows the exact predictions for every data point.</li>
</ul>
<p><strong>(LC6.11)</strong> What does the intercept represent in a multiple regression model with two explanatory variables?</p>
<ul>
<li>A. The effect of one explanatory variable, keeping the other constant.</li>
<li>B. The change in the response variable per unit change in the explanatory variable.</li>
<li>C. The correlation between the two explanatory variables.</li>
<li>D. The expected value of the response variable when all regressors are zero.</li>
</ul>
<p><strong>(LC6.12)</strong> What does the term “partial slope” refer to in a multiple regression model?</p>
<ul>
<li>A. The additional effect of a regressor on the response variable, when all the other regressors have been taken into account.</li>
<li>B. The total slope of all variables combined.</li>
<li>C. The slope when all variables are zero.</li>
<li>D. The average of all slopes in the model.</li>
</ul>
<div class="learncheck">

</div>
</div>
<div id="model3points" class="section level3" number="6.2.3">
<h3>
<span class="header-section-number">6.2.3</span> Observed/fitted values and residuals<a class="anchor" aria-label="anchor" href="#model3points"><i class="fas fa-link"></i></a>
</h3>
<p>As shown in Subsection <a href="multiple-regression.html#model4points">6.1.4</a> for the UN member states
example, we find the fitted values and residuals for our credit card
debt regression model. The fitted values for the credit card debt
(<span class="math inline">\(\widehat{\text{debt}}\)</span>) are computed using the equation for the
regression plane:</p>
<p><span class="math display">\[
\begin{aligned}
\widehat{y} = \widehat{\text{debt}} &amp;= -385.179 + 0.263 \cdot x_1 - 7.663 \cdot x_2
\end{aligned}
\]</span> where <span class="math inline">\(x_1\)</span> is <code>credit_limit</code> and <span class="math inline">\(x_2\)</span> is <code>income</code>. The residuals
are the difference between the observed credit card debt and the fitted
credit card debt, <span class="math inline">\(y - \widehat y\)</span>, for each observation in the data
set. In R, we find the fitted values, <code>debt_hat</code>, and residuals,
<code>residual</code>, using the <code><a href="moderndive.github.io/moderndive/reference/get_regression_points.html">get_regression_points()</a></code> function. In Table
<a href="multiple-regression.html#tab:model3-points-table">6.9</a> we present the first 10 rows of output.
Remember that the coordinates of each of the points in our 3D
scatterplot in Figure <a href="multiple-regression.html#fig:3D-scatterplot">6.6</a> can be found in the
<code>income</code>, <code>credit_limit</code>, and <code>debt</code> columns.</p>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="moderndive.github.io/moderndive/reference/get_regression_points.html">get_regression_points</a></span><span class="op">(</span><span class="va">debt_model</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table" style="font-size: 16px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:model3-points-table">TABLE 6.9: </span>Regression points (First 10 credit card holders out of 400)
</caption>
<thead><tr>
<th style="text-align:right;">
ID
</th>
<th style="text-align:right;">
debt
</th>
<th style="text-align:right;">
credit_limit
</th>
<th style="text-align:right;">
income
</th>
<th style="text-align:right;">
debt_hat
</th>
<th style="text-align:right;">
residual
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
333
</td>
<td style="text-align:right;">
3606
</td>
<td style="text-align:right;">
14.9
</td>
<td style="text-align:right;">
454
</td>
<td style="text-align:right;">
-120.8
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
903
</td>
<td style="text-align:right;">
6645
</td>
<td style="text-align:right;">
106.0
</td>
<td style="text-align:right;">
559
</td>
<td style="text-align:right;">
344.3
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
580
</td>
<td style="text-align:right;">
7075
</td>
<td style="text-align:right;">
104.6
</td>
<td style="text-align:right;">
683
</td>
<td style="text-align:right;">
-103.4
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
964
</td>
<td style="text-align:right;">
9504
</td>
<td style="text-align:right;">
148.9
</td>
<td style="text-align:right;">
986
</td>
<td style="text-align:right;">
-21.7
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
331
</td>
<td style="text-align:right;">
4897
</td>
<td style="text-align:right;">
55.9
</td>
<td style="text-align:right;">
481
</td>
<td style="text-align:right;">
-150.0
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1151
</td>
<td style="text-align:right;">
8047
</td>
<td style="text-align:right;">
80.2
</td>
<td style="text-align:right;">
1127
</td>
<td style="text-align:right;">
23.6
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
203
</td>
<td style="text-align:right;">
3388
</td>
<td style="text-align:right;">
21.0
</td>
<td style="text-align:right;">
349
</td>
<td style="text-align:right;">
-146.4
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
872
</td>
<td style="text-align:right;">
7114
</td>
<td style="text-align:right;">
71.4
</td>
<td style="text-align:right;">
948
</td>
<td style="text-align:right;">
-76.0
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
279
</td>
<td style="text-align:right;">
3300
</td>
<td style="text-align:right;">
15.1
</td>
<td style="text-align:right;">
371
</td>
<td style="text-align:right;">
-92.2
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
1350
</td>
<td style="text-align:right;">
6819
</td>
<td style="text-align:right;">
71.1
</td>
<td style="text-align:right;">
873
</td>
<td style="text-align:right;">
477.3
</td>
</tr>
</tbody>
</table></div>
<!--
I've added the correlation property of invariance under linear transformations in the main text. The Simpson's Paradox example presenting by separating the data in 4 groups based on credit limit should be moved to an appendix. AV 8/13/24
-->
</div>
</div>
<div id="mult-reg-conclusion" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> Conclusion<a class="anchor" aria-label="anchor" href="#mult-reg-conclusion"><i class="fas fa-link"></i></a>
</h2>
<div id="additional-resources-4" class="section level3" number="6.3.1">
<h3>
<span class="header-section-number">6.3.1</span> Additional resources<a class="anchor" aria-label="anchor" href="#additional-resources-4"><i class="fas fa-link"></i></a>
</h3>
<p>An R script file of all R code used in this chapter is available <a href="scripts/06-multiple-regression.R">here</a>.</p>
</div>
<div id="whats-to-come-5" class="section level3" number="6.3.2">
<h3>
<span class="header-section-number">6.3.2</span> What’s to come?<a class="anchor" aria-label="anchor" href="#whats-to-come-5"><i class="fas fa-link"></i></a>
</h3>
<p>This chapter concludes the “Statistical/Data Modeling with <code>moderndive</code>”
portion of this book. We are ready to proceed to Part III: “Statistical
Inference with <code>infer</code>.” Statistical inference is the science of
inferring about some unknown quantity using sampling. So far, we have
only studied the regression coefficients and their interpretation. In
later chapters we learn how we can use information from a
sample to make inferences about the entire population.</p>
<p>Once we have covered Chapters <a href="sampling.html#sampling">7</a> on sampling,
<a href="confidence-intervals.html#confidence-intervals">8</a> on confidence intervals, and
<a href="hypothesis-testing.html#hypothesis-testing">9</a> on hypothesis testing, we revisit the
regression models in Chapter <a href="inference-for-regression.html#inference-for-regression">10</a> on
inference for regression. This will complete the topics in this book, as shown
in Figure <a href="multiple-regression.html#fig:part3">6.7</a>!</p>
<p>Also in Chapter <a href="inference-for-regression.html#inference-for-regression">10</a>, we revisit the
concept of residuals <span class="math inline">\(y - \widehat{y}\)</span> and discuss their importance when
interpreting the results of a regression model. We perform what is known
as a <em>residual analysis</em> of the <code>residual</code> variable of all
<code><a href="moderndive.github.io/moderndive/reference/get_regression_points.html">get_regression_points()</a></code> outputs. Residual analyses enable us to verify
what are known as the <em>conditions for inference for regression</em>.</p>

<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:part3"></span>
<img src="images/flowcharts/flowchart/flowchart.006.png" alt="ModernDive flowchart – on to Part III!" width="65%"><p class="caption">
FIGURE 6.7: <em>ModernDive</em> flowchart – on to Part III!
</p>
</div>


</div>
</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="regression.html"><span class="header-section-number">5</span> Simple Linear Regression</a></div>
<div class="next"><a href="sampling.html"><span class="header-section-number">7</span> Sampling</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#multiple-regression"><span class="header-section-number">6</span> Multiple Regression</a></li>
<li><a class="nav-link" href="#mult-reg-packages">Needed packages</a></li>
<li>
<a class="nav-link" href="#model4"><span class="header-section-number">6.1</span> One numerical and one categorical explanatory variable</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#model4EDA"><span class="header-section-number">6.1.1</span> Exploratory data analysis</a></li>
<li><a class="nav-link" href="#model4interactiontable"><span class="header-section-number">6.1.2</span> Model with interactions</a></li>
<li><a class="nav-link" href="#model4table"><span class="header-section-number">6.1.3</span> Model without interactions</a></li>
<li><a class="nav-link" href="#model4points"><span class="header-section-number">6.1.4</span> Observed responses, fitted values, and residuals</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#model3"><span class="header-section-number">6.2</span> Two numerical explanatory variables</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#model3EDA"><span class="header-section-number">6.2.1</span> Exploratory data analysis</a></li>
<li><a class="nav-link" href="#model3table"><span class="header-section-number">6.2.2</span> Multiple regression with two numerical regressors</a></li>
<li><a class="nav-link" href="#model3points"><span class="header-section-number">6.2.3</span> Observed/fitted values and residuals</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#mult-reg-conclusion"><span class="header-section-number">6.3</span> Conclusion</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#additional-resources-4"><span class="header-section-number">6.3.1</span> Additional resources</a></li>
<li><a class="nav-link" href="#whats-to-come-5"><span class="header-section-number">6.3.2</span> What’s to come?</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/moderndive/ModernDive_book//blob/v2/06-multiple-regression.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/moderndive/ModernDive_book//edit/v2/06-multiple-regression.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Statistical Inference via Data Science</strong>: A ModernDive into R and the Tidyverse <br> (Second Edition)" was written by Chester Ismay, Albert Y. Kim, and Arturo Valdivia <br> Foreword by Kelly S. McConville. It was last built on August 06, 2025.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
