
Needed packages

```{r lc-11-1, message=FALSE}
library(tidyverse)
library(moderndive)
library(fivethirtyeight)
library(infer)
``` 

**(LC11.1)** Check that the LINE conditions are met for inference in the Seattle house prices example with
`price_interaction <- lm(log10_price ~ log10_size * condition, data = house_prices)`.

**Solution:**

```{r lc-11-sized}
price_interaction <- lm(
  log10_price ~ log10_size * condition,
  data = house_prices
)

regression_points <- get_regression_points(price_interaction, ID = "id")
```

Plot log10 size and log10 price by condition:

```{r lc-11-alt2, fig.cap="Log10 size vs. log10 price by condition."}
ggplot(house_prices, aes(x = log10(sqft_living), y = log10(price), color = condition)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Log10 Size (sqft)", y = "Log10 Price ($)", color = "Condition")
```

* **Linearity:** The relationship between log10 size and log10 price is approximately linear within each condition level. This is a little challenging to see due to overplotting.
* **Independence:** Each house sale is a separate observation, so independence is reasonable.

Plot Q-Q plot of residuals:

```{r lc-11-v4}
ggplot(regression_points, aes(sample = residual)) +
  geom_qq(alpha = 0.3) +
  geom_qq_line(color = "red") +
  labs(title = "Q-Q Plot of Residuals")
```

Histogram of residuals:

```{r lc-11-hist-white-border, fig.cap="Histogram of residuals."}
ggplot(regression_points, aes(x = residual)) +
  geom_histogram(binwidth = 0.05, color = "white") +
  labs(x = "Residual")
```

* **Normality:** Residuals appear roughly bell-shaped after the log10 transformation.

Plot residuals vs. fitted (`log10_price_hat`) values:

```{r lc-11-v6, fig.cap="Residuals vs. fitted values."}
ggplot(regression_points, aes(x = log10_price_hat, y = residual)) +
  geom_point(alpha = 0.3) +
  geom_hline(yintercept = 0, color = "red") +
  labs(x = "Fitted Values", y = "Residuals")
```

* **Equal variance:** The spread of residuals is fairly constant across fitted values.
  Overall, the LINE conditions are reasonably satisfied.

**(LC11.2)** Repeat the regression modeling and prediction for a house of condition 5 and size 1900 square feet, but using the parallel slopes model.

**Solution:**

```{r lc-11-v7}
house_prices <- house_prices |> 
  mutate(
    log10_price = log10(price),
    log10_size = log10(sqft_living)
  )
# Fit regression model:
price_interaction <- lm(log10_price ~ log10_size + condition,
  data = house_prices
)

# Get regression table:
get_regression_table(price_interaction)

10^(2.88 + 0.096 + 0.837 * log10(1900))
```

**(LC11.3)** Interpret the results of the other rows in `get_regression_table(price_interaction)` not already discussed.

**Solution:**

* `condition2`–`condition5`: These give the intercept differences relative to condition 1 houses. For example, a positive value for `condition5` means condition 5 houses start with higher baseline log10 price at size = 1 square foot.
* `log10_size:condition2`–`log10_size:condition5`: These give slope differences relative to condition 1. A positive coefficient means price increases faster with size for that condition compared to condition 1.

**(LC11.4)** Create, visualize, and interpret confidence intervals using both theory-based and simulation-based approaches.

**Solution:**

* **Theory-based:** Use `get_regression_table(price_interaction)` which reports CIs from the $t$-distribution. For example, the CI for `log10_size` excludes 0, so size is significant.
* **Simulation-based:** Bootstrap the regression with resampling (`infer` package with `fit()` + `get_confidence_interval()`). Plot the bootstrap distribution of coefficients and shade the middle 95%.
  Both approaches agree: only `log10_size` has a confidence interval that does not include 0, confirming its significant relationship with log10 price.

**(LC11.5)** What date between 1994 and 2003 has the fewest number of births in the US? What story could you tell about why?

**Solution:**

```{r lc-11-demo-code}
US_births_1994_2003 |> 
  arrange(births)
```

The dates with the fewest number of births in the US were 12/25 of the years of 2001, 2000, 2003, 2002, and 1999. Because it is Christmas Day and hospitals don't generally induce labor on that day. 

