--- 
title: "`r ifelse(knitr::is_latex_output(), 'Statistical Inference via Data Science:  A ModernDive into R and the Tidyverse', 'Statistical Inference via Data Science')`"
subtitle: "`r ifelse(knitr::is_latex_output(), '', 'A ModernDive into R and the Tidyverse <br> (Second Edition)')`"
author: "`r ifelse(knitr::is_latex_output(), 'Chester Ismay, Albert Y. Kim, and Arturo Valdivia', 'Chester Ismay, Albert Y. Kim, and Arturo Valdivia <br> Foreword by Kelly S. McConville')`"
date: "`r format(Sys.time(), '%B %d, %Y')`"
site: bookdown::bookdown_site
bibliography: [bib/books.bib, bib/packages.bib, bib/articles.bib]
link-citations: yes
always_allow_html: yes
# github-repo: moderndive/ModernDive_book
---

```{r set-options, include=FALSE, purl=FALSE}
# Current version information: Date here should match the date in the YAML above.
# Remove .9000 tag and set date to release date when releasing
version <- "2.0.0"
date <- "December 4, 2024"

# Latest release information:
latest_release_version <- "2.0.0"
latest_release_date <- "March 20, 2025"

# knitr pkg is needed throughout book
if (!"knitr" %in% installed.packages()) {
  install.packages("knitr", repos = "http://cran.rstudio.com")
}
library(knitr)

# Set output options
if (is_html_output()) {
  options(width = 120)
}
if (is_latex_output()) {
  options(width = 80)
}
options(digits = 7, bookdown.clean_book = TRUE, knitr.kable.NA = "NA")
opts_chunk$set(
  tidy = FALSE,
  out.width = "\\textwidth",
  fig.align = "center",
  comment = NA,
  fig.pos = 'H',
  fig.retina = 1,
#  fig.width = if(knitr::is_html_output()) "6",
  fig.asp = if(knitr::is_html_output()) "2/3"
)
```

```{r index-conditional, include=FALSE}
# Install CRAN packages needed
needed_CRAN_pkgs <- c(
  # Packages used by book reader
  "dygraphs", "fivethirtyeight", "gapminder", "ggplot2movies", "infer", 
  "ISLR2", 
  "janitor", "knitr", "moderndive", 
  "nycflights23", "scales", "tidyverse", "broom", "bookdown",
  "gridExtra",
  "GGally",
  
  # Packages only used internally for bookdown book building
  "devtools", "ggrepel", "here", "kableExtra", "mvtnorm", "patchwork", 
  "remotes", "rmarkdown", "sessioninfo", "viridis", "webshot"
)
new_pkgs <- needed_CRAN_pkgs[!(needed_CRAN_pkgs %in% installed.packages())]
if (length(new_pkgs)) {
  install.packages(new_pkgs, repos = "http://cran.rstudio.com")
}

# if (!"infer" %in% installed.packages()) {
#   install.packages("remotes", repos = "http://cran.rstudio.com")
#   remotes::install_github("tidymodels/infer")
# }

# Used in 95-appendixE.Rmd
needed_pkgs <- unique(c(
  needed_CRAN_pkgs, "bookdown"
))

# Automatically create a bib database for R packages
write_bib(
  c(
    .packages(), 
    "bookdown", "broom", "dplyr", #"dygraphs", 
    "fivethirtyeight", "forcats", "gapminder",
    "ggplot2", "ggplot2movies", "ggrepel", "gridExtra",
    "infer", "ISLR2", "janitor", "kableExtra", "knitr", 
    "lubridate", "moderndive", "mvtnorm", "GGally",
    #    "nycflights13", 
    "nycflights23", "patchwork", "purrr", "readr", "rmarkdown",
    "scales", "sessioninfo", "stringr", "tibble", "tidyr", "tidyverse", 
    "viridis", "viridisLite"
  ),
  here::here("bib", "packages.bib")
)

# Check that phantomjs is installed to create screenshots of apps
if (is.null(webshot:::find_phantom())) {
  webshot::install_phantomjs()
}

# Add all simulation results here
if (!dir.exists("rds")) {
  dir.create("rds")
}

# Create empty docs folder which will ultimately contain output
if (!dir.exists("docs")) {
  dir.create("docs")
}

# Create empty docs folder which will ultimately contain output
if (!dir.exists("docs/v2")) {
  dir.create("docs/v2")
}

# Copy over the _redirects file
file.copy("_redirects", "docs", overwrite = TRUE)

# Make sure all images copy to docs folder
if (!dir.exists(here::here("docs", "images"))) {
  dir.create(here::here("docs", "images"))
}
file.copy(from = "images", to = "docs", recursive = TRUE)

# These steps are only needed for generating the moderndive.com page
# with relevant links. Not needed for PDF generation.
if (is_html_output()) {
  # Add all purl()'ed chapter R scripts here
  if (dir.exists(here::here("docs", "scripts"))) {
    unlink(here::here("docs", "scripts"), recursive = TRUE)
  }
  if (!dir.exists(here::here("docs", "scripts"))) {
    dir.create(here::here("docs", "scripts"))
  }
}
```


```{r index-conditional-text, results="asis", echo=FALSE, purl=FALSE}
if (is_html_output()) {
  cat("# Welcome to ModernDive (v2) {-}")
}
```


<!-- purl() all the chapter Rmd's in a new session -->
```{bash, include=FALSE, purl=FALSE}
Rscript -e "source('purl.R', local = TRUE)"
```


```{r set-options2, include=FALSE, purl=FALSE}
if (is_html_output()) {
  file.remove("purl.Rout")
  
  # Copy all needed csv and txt files to docs/
  if (!dir.exists(here::here("docs", "data"))) {
    dir.create(here::here("docs", "data"))
  }
  data_files <- c(
    "dem_score.csv", "dem_score.xlsx", "le_mess.csv", "ideology.csv",
    # For Appendix B
    "ageAtMar.csv", "offshore.csv", "cleSac.txt", "zinc_tidy.csv",
    # For Appendix C
    "movies.csv",
    # For moderndive package paper
    # https://www.kaggle.com/c/house-prices-advanced-regression-techniques
    "train.csv", "test.csv"
  )
  from_vec <- here::here("data", data_files)
  to_vec <- here::here("docs", "data", data_files)
  purrr::walk2(from_vec, to_vec, file.copy, overwrite = TRUE)
  
  # To be updated to include the actual link to labs website
  # when Albert has those ready
  file.copy("labs.html", here::here("docs", "labs.html"), overwrite = TRUE)
  file.copy("regression-plane.html",
            here::here("docs", "regression-plane.html"),
            overwrite = TRUE
  )
  file.copy("regression-plane-ISLR2.html",
            here::here("docs", "regression-plane-ISLR2.html"),
            overwrite = TRUE
  )
  
  # Copy previous_versions/ to docs/previous_versions/
  if (!dir.exists(here::here("docs", "previous_versions"))) {
    dir.create(here::here("docs", "previous_versions"))
  }
  file.copy(from = "previous_versions", to = "docs", recursive = TRUE)
  
  # For some reason widelogo in header needs to be done separately.
  # Loaded in _includes/logo.html
  file.copy(here::here("images", "logos", "wide_format.png"),
            here::here("docs", "wide_format.png"),
            overwrite = TRUE
  )
}


# Set ggplot2 theme to be light if outputting to PDF
library(ggplot2) 
if (is_latex_output()) {
  theme_set(theme_light())
} else {
  theme_set(theme_grey())
}

# For generating the R script files at the end of relevant chapters
generate_r_file_link <- function(file) {
  if (is_latex_output()) {
    cat(glue::glue("An R script file of all R code used in this chapter is available at <https://www.moderndive.com/v2/scripts/{file}>."))
  } else {
    cat(glue::glue("An R script file of all R code used in this chapter is available [here](scripts/{file})."))
  }
}

# To get kable tables to print nicely in .tex file
if (is_latex_output()) {
  options(kableExtra.auto_format = FALSE, knitr.table.format = "latex")
}
```

```{r images, include=FALSE, purl=FALSE}
source("R/image_functions.R")
```


<!--
```{block, type='announcement', purl=FALSE}
**This is a previous version (v`r version`) of *ModernDive* and may be out of date. For the current version of *ModernDive*, please go to [ModernDive.com/v2/](https://moderndive.com/v2/).**
```
-->

<!--
```{block, type='learncheck', include=!is_latex_output(), purl=FALSE}
**Please note that you are currently looking at a preview of a future version of *ModernDive*, which is currently being edited. For the current version of *ModernDive*, please visit [ModernDive.com](https://moderndive.com/).**
```
-->


```{r index-create-dev_version, echo=FALSE, include=!is_latex_output(), purl=FALSE}
dev_version <- FALSE
```

<div class='book-cover'><img src="images/logos/v2_cover.jpg" width="350" alt=""/></div>

```{block, include=is_html_output(), purl=FALSE}
This is the [website](https://moderndive.com/v2/) for *Statistical Inference via Data Science:  A ModernDive into R and the Tidyverse (Second Edition)*! Visit the [GitHub repository for this site](https://github.com/moderndive/ModernDive_book/tree/v2/). It will be published as a print copy by CRC Press in 2025! You can find a summary of the updates in this version [here](https://moderndive.com/v2/preface.html#about-the-book).
```

```{block, include=is_html_output(), purl=FALSE}
The First Edition of this book is available at https://moderndive.com. You can find the printed copy of the First Edition on [Amazon](https://www.amazon.com/Statistical-Inference-via-Data-Science/dp/0367409828/). You can also purchase it at [CRC Press](https://www.routledge.com/Statistical-Inference-via-Data-Science-A-ModernDive-into-R-and-the-Tidyverse/Ismay-Kim/p/book/9780367409821?utm_source=author&utm_medium=shared_link&utm_campaign=B043134_jm1_5ll_6rm_t081_1al_statisticalinferenceviadatascienceauthorshare).
```


<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />This work by [Chester Ismay](https://chester.rbind.io/), [Albert Y. Kim](https://rudeboybert.rbind.io/), and [Arturo Valdivia](https://avaldivi6.github.io) is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.

<a href="https://www.netlify.com"> <img src="https://www.netlify.com/v3/img/components/netlify-color-accent.svg" alt="Deploys by Netlify" /> </a>

<!-- index.Rmd has to have some content in it or it won't create an index.html 
file. Make sure to keep this in so that index.html is included. -->

# Foreword {-}
