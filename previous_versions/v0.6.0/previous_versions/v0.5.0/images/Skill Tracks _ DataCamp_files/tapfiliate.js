(function(){var w=window;var gns=window.TapfiliateObject||"tap";var actionQ=w[gns]?w[gns].q||[]:[];if(w[gns]&&w[gns].loaded)return;w[gns]=function(func,a,b,c,d,e){var tapFunc=w[gns][func];if(typeof tapFunc==="function"){tapFunc(a,b,c,d,e)}else{throw'Function "'+func+'" not supported'}};w[gns].loaded=true;w[gns].baseUrl="//frstre.com";w[gns].baseUrlDepr="https://tapfiliate.com";var beaconUrl="https://b.frstre.com";var beaconUrlDepr="https://beacon.tapfiliate.com";var beaconVersion="v1.4";w[gns].Tracking=w[gns].Tracking||{};w[gns].options=w[gns].options||{};var vidRead,account;String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};if(!("indexOf"in Array.prototype)){Array.prototype.indexOf=function(find,i){if(i===undefined)i=0;if(i<0)i+=this.length;if(i<0)i=0;for(var n=this.length;i<n;i++)if(i in this&&this[i]===find)return i;return-1}}function bindEvent(el,eventName,eventHandler){if(el.addEventListener){el.addEventListener(eventName,eventHandler,false)}else if(el.attachEvent){el.attachEvent("on"+eventName,eventHandler)}}function removeUndefined(obj){for(key in obj){if(obj[key]===undefined)delete obj[key]}return obj}var objectToQueryString=function(a){var prefix,s,add,name,r20,output;s=[];r20=/%20/g;add=function(key,value){value=typeof value=="function"?value():value===null?"":value;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(a instanceof Array){for(name in a){add(name,a[name])}}else{for(prefix in a){buildParams(prefix,a[prefix],add)}}output=s.join("&").replace(r20,"+");return output};function buildParams(prefix,obj,add){var name,i,l,rbracket;rbracket=/\[\]$/;if(obj instanceof Array){for(i=0,l=obj.length;i<l;i++){if(rbracket.test(prefix)){add(prefix,obj[i])}else{buildParams(prefix+"["+(typeof obj[i]==="object"?i:"")+"]",obj[i],add)}}}else if(typeof obj=="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],add)}}else{add(prefix,obj)}}function ajax(url,data,method,callback){data=removeUndefined(data);var params=objectToQueryString(data);var getUrl=url+"?"+params;method=method||(getUrl.length>2083?"POST":"GET");var _url=method==="GET"?getUrl:url;data=method==="POST"?JSON.stringify(data):null;var xhr=new XMLHttpRequest;if("withCredentials"in xhr){xhr.open(method,_url,true)}else if(typeof XDomainRequest!="undefined"){xhr=new XDomainRequest;var emptyFunc=function(){return};var loadFunc=function(){if(typeof callback=="function"){callback(xhr,true)}};xhr.onerror=emptyFunc;xhr.ontimeout=emptyFunc;xhr.onprogress=emptyFunc;xhr.onload=loadFunc;xhr.timeout=5e3;xhr.open(method,_url)}else{return}xhr.onreadystatechange=ensureReadiness;function ensureReadiness(){if(xhr.readyState<4){return}if(xhr.status!==200){if(typeof callback=="function")callback(xhr,false);return}if(xhr.readyState===4){if(typeof callback=="function")callback(xhr,true)}}xhr.send(data)}function getUrlParams(){var assoc={};var decode=function(s){return decodeURIComponent(s.replace(/\+/g," "))};var queryString=location.search.substring(1);var hashString=location.hash.substring(1);var keyValues=queryString.split("&");keyValues=keyValues.concat(hashString.split("&"));for(var i in keyValues){if(!keyValues.hasOwnProperty(i))continue;var key=keyValues[i].toString().split("=");if(key.length>1){assoc[decode(key[0])]=decode(key[1])}}return assoc}function readyToTrack(){return vidRead}function tryFlush(){if(readyToTrack()){w[gns].Click.flushQueue();w[gns].Conversion.flushQueue()}}function setVids(vids){w[gns].vid=vids.sort()[0];w[gns].vids=vids;vidRead=true}function getVids(){if(w[gns].vids){var truthyUniqueVids=[];for(var i=w[gns].vids.length-1;i>=0;i--){var vid=w[gns].vids[i];if(vid&&truthyUniqueVids.indexOf(vid)===-1){truthyUniqueVids.push(vid)}}if(truthyUniqueVids.length)return truthyUniqueVids}}function Storage(){var chain={},chainLength=0,readQueue=[],writeQueue=[],_inited=false,self=this;function flushQueues(){for(var i=readQueue.length-1;i>=0;i--){self.read.apply(self,readQueue[i])}for(var ii=writeQueue.length-1;ii>=0;ii--){self.write.apply(self,writeQueue[ii])}}this.addMethod=function(method){if(!method.supported())return;chainLength++;chain[method.key]=method;return this};this.init=function(){var calls=chainLength;function done(){calls--;if(calls<=0){_inited=true;flushQueues()}}for(var method in chain){if(typeof chain[method].init=="function"){chain[method].init(done)}else{done()}}};this.read=function(key,options,cb){if(!_inited){readQueue.push(arguments);return}var calls=chainLength;var results=[];var timeouts={};function done(err,val,method){clearTimeout(timeouts[method]);if(val&&val.constructor===Array){results=results.concat(val)}else{results.push(val)}calls--;if(calls===0){cb(null,results)}}for(var method in chain){timeouts[method]=setTimeout(done,2e3);try{chain[method].read(key,done)}catch(err){}}};this.write=function(key,value,options,cb){if(!_inited){writeQueue.push(arguments)}var calls=chainLength;function done(err,val){calls--;if(calls===0){if(typeof cb=="function")cb()}}for(var method in chain){chain[method].write(key,value,options,done)}};return this}w[gns].Storage=w[gns].Storage||new Storage;function StorageMethod(key,options){this.key=key;this.options=options||{};this.setOption=function(key,value){this.options[key]=value};return this}StorageMethod.prototype.supported=function(){return true};var methodFpCookie=new StorageMethod("1pCookie");methodFpCookie.read=function(key,cb){var name=key+"=";var ca=document.cookie.split(";");var result=[];for(var i=0;i<ca.length;i++){var c=ca[i].trim();if(c.indexOf(name)===0){result.push(c.substring(name.length,c.length))}}cb(null,result,this.key)};methodFpCookie.write=function(key,value,options,cb){var d=new Date;d.setTime(d.getTime()+50*365*24*60*60*1e3);var expires="expires="+d.toGMTString();var domain;try{var str=window.location.href;var match=str.match(/(?:https?:\/\/)?(?:www\.)?(.*?)\//);domain="."+match[match.length-1]}catch(err){}var cookie=key+"="+value+"; "+expires+"; path=/";cookie+=typeof domain!="undefined"?"; domain="+domain:"";document.cookie=cookie;cb()};w[gns].Storage.addMethod(methodFpCookie);var methodLocalStorage=new StorageMethod("localStorage");methodLocalStorage.supported=function(){return typeof localStorage!=="undefined"};methodLocalStorage.read=function(key,cb){cb(null,localStorage.getItem(key),this.key)};methodLocalStorage.write=function(key,value,options,cb){cb(null,localStorage.setItem(key,value))};w[gns].Storage.addMethod(methodLocalStorage);function ThreePStorageMethod(){this.constructor.apply(this,arguments);this.callbacks={};return this}ThreePStorageMethod.prototype=new StorageMethod;ThreePStorageMethod.prototype.supported=function(){return typeof postMessage!=="undefined"};ThreePStorageMethod.prototype.handleEvent=function(e){if(e.origin!==this.options.url){return}var message;try{message=JSON.parse(e.data)}catch(err){}if(message&&message.callback){this.callbacks[message.callback](message.value)}};ThreePStorageMethod.prototype.init=function(cb){var ifrm=document.createElement("IFRAME");ifrm.setAttribute("src",this.options.url+"/?"+this.options.beaconVersion);ifrm.style.width=1+"px";ifrm.style.height=1+"px";ifrm.style.display="none";bindEvent(window,"message",this);var self=this;bindEvent(ifrm,"load",function(){self.beacon=ifrm.contentWindow;cb()});function addBeacon(){document.body.appendChild(ifrm)}setTimeout(addBeacon,0)};ThreePStorageMethod.prototype.post=function(message){this.beacon.postMessage(message,this.options.url)};ThreePStorageMethod.prototype.read=function(key,cb){var self=this;this.callbacks.get=function(a){cb(null,a,self.key)};var msgObj={action:"getAll",key:key};this.post(JSON.stringify(msgObj))};ThreePStorageMethod.prototype.write=function(key,value,options,cb){this.callbacks.set=function(a){cb(null,a)};var msgObj={action:"set",key:key,value:value};this.post(JSON.stringify(msgObj))};w[gns].Storage.addMethod(new ThreePStorageMethod("3pCookie",{url:beaconUrl,beaconVersion:beaconVersion}));w[gns].Storage.addMethod(new ThreePStorageMethod("3pCookieDepr",{url:beaconUrlDepr,beaconVersion:beaconVersion}));w[gns].Storage.init();function getReferralCode(ref,referralCodeParam){if(ref||ref===0)return ref;referralCodeParam=referralCodeParam||"ref";return getUrlParams()[referralCodeParam]}w[gns].Click=w[gns].Click||{};w[gns].Click.q=w[gns].Click.q||[];w[gns].Click.track=function(aid,sid,options,callback){options=options||{};var referral_code;var referral_code_param;var refc;if(options.referral_code_param!==null||options.referral_code!==undefined){referral_code=options.referral_code;referral_code_param=options.referral_code_param;refc=getReferralCode(referral_code,referral_code_param)}if(!(aid&&sid)&&!refc)return handleErrorCallback("No tracking parameters",options,callback);var queryParams=getUrlParams();var meta=null;for(var key in queryParams){if(key.slice(0,3)==="tm_"){meta=meta||{};meta[key.slice(3,key.length)]=queryParams[key]}}var c={data:{acc:account,aid:aid,sid:sid,callback:callback,options:options,pm:meta,ref:document.referrer||null,cup:document.location.href||null}};if(refc)c.data.refc=refc;w[gns].Click.q.push(c);tryFlush()};w[gns].Click.flushQueue=function(){w[gns].Click.q.reverse();for(var i=w[gns].Click.q.length-1;i>=0;i--){var c=w[gns].Click.q[i].data;var vids=getVids();if(c.aid&&c.sid||c.refc){var data={acc:c.acc,aid:c.aid,sid:c.sid,pm:c.pm,ref:c.ref,cup:c.cup,refc:c.refc};if(vids){data.vids=vids}ajax(w[gns].baseUrl+"/event/",data,null,function(xhr,success){var responseData=xhr.response||xhr.responseText;if(success&&responseData){var response=JSON.parse(responseData);if(response.vid){w[gns].Storage.write("tap_vid",response.vid);setVids([response.vid]);if(typeof c.callback=="function"){c.options.always_callback==true?c.callback(null,response):c.callback(response)}return}}return handleErrorCallback("Tracking request failed",c.options,c.callback)})}w[gns].Click.q.splice(i,1)}};w[gns].Conversion=w[gns].Conversion||{};w[gns].Conversion.q=w[gns].Conversion.q||[];w[gns].Conversion.flushQueue=function(){w[gns].Conversion.q.reverse();for(var i=w[gns].Conversion.q.length-1;i>=0;i--){var t=w[gns].Conversion.q[i].data;var type=w[gns].Conversion.q[i].type;var vids=typeof w[gns].Conversion.q[i].vid!=="undefined"?w[gns].Conversion.q[i].vid:getVids();if(t.acc&&vids||t.options.attribution_id){var url=w[gns].baseUrlDepr+"/api/conversions/track/";var data;if(type=="single"){data={acc:t.acc,vid:vids,tid:t.tid,tam:t.tam,options:t.options,ct:t.ct}}else if(type=="multi"){data={acc:t.acc,vid:vids,tid:t.tid,options:t.options,com:t.com}}else{return handleErrorCallback("Missing request type",t.options,t.callback)}ajax(url,data,"POST",function(result,success){if(!success){return handleErrorCallback("Conversion denied",t.options,t.callback)}var conversion;try{conversion=JSON.parse(result.response)}catch(e){return handleErrorCallback("Conversion denied",t.options,t.callback)}if(typeof t.callback=="function"){t.options.always_callback==true?t.callback(null,conversion):t.callback(conversion,"success")}})}else{return handleErrorCallback("Non-tracked visitor",t.options,t.callback)}if(vids&&vids.length){w[gns].Conversion.q.splice(i,1)}}};function handleErrorCallback(message,options,callback){if(typeof callback!="function")return;if(options.always_callback==true)return callback(message);if(options.alwaysFireCb===true)return callback(null,"error",message)}w[gns].create=function(acc,options,callback){account=acc;w[gns].Storage.read("tap_vid",{},function(err,v){setVids(v);tryFlush();if(typeof callback=="function"){callback()}})};w[gns].detect=function(options,callback){options=options||{};this.urlParams=getUrlParams();var aid=this.urlParams[options.asset_param||"tap_a"];var sid=this.urlParams[options.source_param||"tap_s"];w[gns].Click.track(aid,sid,options,callback)};w[gns].click=function(tp,options,callback){var _tp=tp||{};options=options||{};var aid=_tp.tap_a||_tp.asset_id;var sid=_tp.tap_s||_tp.source_id;if(typeof _tp.referral_code!=="undefined")options.referral_code=_tp.referral_code;w[gns].Click.track(aid,sid,options,callback)};w[gns].conversion=function(tid,tam,options,ct,callback){tid=tid||null;tam=typeof tam!="undefined"?tam:null;options=options||{};var acc=account;var t={type:"single",data:{acc:acc,tid:tid,tam:tam,options:options,ct:ct,callback:callback}};w[gns].Conversion.q.push(t);tryFlush()};w[gns].transactionMulti=function(tid,options,com,callback){w[gns].conversionMulti(tid,options,com,callback)};w[gns].conversionMulti=function(tid,options,com,callback){options=options||{};var t={type:"multi",data:{acc:account,tid:tid,com:com,options:options,callback:callback}};w[gns].Conversion.q.push(t);tryFlush()};w[gns].detectClick=function(callback){w[gns].detect({referral_code_param:null},callback)};w[gns].transaction=function(tid,tam,options,ct,callback){w[gns].conversion(tid,tam,options,ct,callback)};var init=function(){var createCalled;actionQ.reverse();for(var i=actionQ.length-1;i>=0;i--){var action=actionQ[i][0];if(action==="create"&&createCalled)continue;w[gns].apply(window,actionQ[i]);actionQ.splice(i,1);if(action==="create")createCalled=true}};init()})();